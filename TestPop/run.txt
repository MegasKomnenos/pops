prod_new_template = {
	name = sheep
	land_type = pasture
	land = 2
	labor = 1
	sply_fiber = 2
}
prod_new_template = {
	name = cloth
	land_type = workshop
	land = 1
	labor = 1
	dmnd_fiber = 2
	sply_textile = 2
}

province:2543 = {
	set_variable = { name = workshop_total value = 10 }
}

prod_new_instance = {
	template = sheep
	location = province:2563
	size = 2
}
prod_new_instance = {
	template = cloth
	location = province:2543
	size = 10
}

scope:prod_new_instance_temp = {
	set_global_variable = { name = foo value = this }
}

prod_new_instance = {
	template = sheep
	location = province:1582
	size = 10
}
prod_new_instance = {
	template = sheep
	location = province:1561
	size = 10
}
prod_new_instance = {
	template = sheep
	location = province:1555
	size = 10
}

trade_new_merchant = {
	location = province:2543.county
	tax = 0
	wealth = 0
	rank = 10
	skill = 20
	outpost = 2
}
trade_new_merchant = {
	location = province:1527.county
	tax = 0
	wealth = 0
	rank = 5
	skill = 10
	outpost = 1
}

province:2543.county = {
	change_variable = { name = trade_price_fiber multiply = 2 }
	change_variable = { name = trade_price_textile divide = 2 }
	
	var:trade_merchant = {
		add_to_variable_list = { name = trade_outposts target = province:2115.county }
		
		set_variable = { name = trade_has_fiber value = 20 }
		set_variable = { name = trade_want_fiber value = 40 }
		
		set_variable = { name = trade_has_textile value = 20 }
		set_variable = { name = trade_want_textile value = 40 }
		
		change_variable = { name = trade_price_fiber multiply = 1.5 }
		change_variable = { name = trade_price_textile divide = 1.5 }
	}
}
province:1527.county = {
	var:trade_merchant = {
		set_variable = { name = trade_has_fiber value = 40 }
		set_variable = { name = trade_want_fiber value = 80 }
		
		set_variable = { name = trade_has_textile value = 20 }
		set_variable = { name = trade_want_textile value = 40 }
		
		change_variable = { name = trade_price_fiber divide = 1.5 }
		change_variable = { name = trade_price_textile multiply = 1.5 }
	}
}
province:1582.county = {
	change_variable = { name = trade_price_fiber divide = 2 }
	change_variable = { name = trade_price_textile multiply = 2 }
}
province:1561.county = {
	change_variable = { name = trade_price_fiber divide = 2 }
	change_variable = { name = trade_price_textile multiply = 2 }
}
province:1555.county = {
	change_variable = { name = trade_price_fiber divide = 2 }
	change_variable = { name = trade_price_textile multiply = 2 }
}

province:2543 = {
	prod_update_instances = yes
}
province:2563 = {
	prod_update_instances = yes
}
province:1582 = {
	prod_update_instances = yes
}
province:1561 = {
	prod_update_instances = yes
}
province:1555 = {
	prod_update_instances = yes
}

global_var:foo = {
	set_variable = { name = prod_in_fiber value = 20 }
}

province:2543 = {
	prod_update_instances = yes
}
province:2563 = {
	prod_update_instances = yes
}
province:1582 = {
	prod_update_instances = yes
}
province:1561 = {
	prod_update_instances = yes
}
province:1555 = {
	prod_update_instances = yes
}

every_county = {
	limit = {
		is_valid_prov = yes
	}
	pop_update_demand = { type = county }
	
	every_county_province = {
		limit = {
			is_valid_prov = yes
			
			is_city = yes
		}
		pop_update_demand = { type = holding }
	}
}

trade_do_trade = yes
trade_resolve_trade = yes
trade_update_merchant = yes
trade_update_price = yes