debug_log = "Test Start"
debug_log = "Start prod_update_instances"

prod_update_instances = yes

debug_log = "End prod_update_instances"
debug_log = "Start forest_main"

forest_main = yes

debug_log = "End forest_main"
debug_log = "Start pop_update_demand"

every_province = {
	limit = {
		is_valid_prov = yes
	}
	pop_update_demand = yes
}

debug_log = "End pop_update_demand"
debug_log = "Start trade_do_trade"

trade_do_trade = yes

debug_log = "End trade_do_trade"
debug_log = "Start trade_resolve_trade"

trade_resolve_trade = yes

debug_log = "End trade_resolve_trade"
debug_log = "Start trade_update_merchant"

trade_update_merchant = yes

debug_log = "End trade_update_merchant"
debug_log = "Start trade_update_price"

trade_update_price = yes

debug_log = "End trade_update_price"
debug_log = "Start trade_set_range"

every_in_global_list = {
	variable = trade_merchants
	
	if = {
		limit = {
			var:trade_power = {
				OR = {
					compare_value >= prev.var:trade_refresh_up
					compare_value <= prev.var:trade_refresh_down
				}
			}
		}
		set_variable = { name = trade_refresh_up value = var:trade_power }
		set_variable = { name = trade_refresh_down value = var:trade_power }
		
		change_variable = { name = trade_refresh_up multiply = 1.25 }
		change_variable = { name = trade_refresh_down multiply = 0.8 }

		change_variable = { name = trade_refresh_up add = 2 }
		change_variable = { name = trade_refresh_down subtract = 2 }
		
		trade_set_range = yes
	}
}

debug_log = "End trade_set_range"
debug_log = "Start build_update_project"

if = {
	limit = {
		has_global_variable_list = build_slots_active
			
		global_variable_list_size = { name = build_slots_active value >= 1}
	}
	every_in_global_list = {
		variable = build_slots_active
		
		build_update_project = yes
	}
}

debug_log = "End build_update_project"
debug_log = "Start pop_resolve_demand"

every_province = {
	limit = {
		is_valid_prov = yes
	}
	pop_resolve_demand = yes
	
	change_variable = { name = pop_wealth add = var:pop_earn_free } 
	change_variable = { name = pop_wealth add = var:pop_earn_serf }
	change_variable = { name = pop_wealth subtract = var:pop_pay_free }
	change_variable = { name = pop_wealth subtract = var:pop_pay_serf }
}

debug_log = "End pop_resolve_demand"
debug_log = "Test End"