province:2 = {
	every_in_list = {
		variable = prod_instances
		set_variable = {
			name = prod_update_instances_t
			value = 1
		}
		set_variable = {
			name = prod_update_instances_tt
			value = 0
		}
		if = {
			limit = {
				has_variable = prod_input_food
			}
			if = {
				limit = {
					var:prod_input_food = {
						compare_value != prev.var:prod_input_actual_food
					}
				}
				change_variable = {
					name = prod_update_instances_t
					multiply = var:prod_input_actual_food
				}
				change_variable = {
					name = prod_update_instances_t
					divide = var:prod_input_food
				}
			}
			change_variable = {
				name = prod_update_instances_tt
				add = 1
			}
			set_variable = {
				name = prod_input_old_food
				value = var:prod_input_food
			}
			set_variable = {
				name = prod_input_actual_old_food
				value = var:prod_input_actual_food
			}
		}
		if = {
			limit = {
				has_variable = prod_input_fiber
			}
			if = {
				limit = {
					var:prod_input_fiber = {
						compare_value != prev.var:prod_input_actual_fiber
					}
				}
				change_variable = {
					name = prod_update_instances_t
					multiply = var:prod_input_actual_fiber
				}
				change_variable = {
					name = prod_update_instances_t
					divide = var:prod_input_fiber
				}
			}
			change_variable = {
				name = prod_update_instances_tt
				add = 1
			}
			set_variable = {
				name = prod_input_old_fiber
				value = var:prod_input_fiber
			}
			set_variable = {
				name = prod_input_actual_old_fiber
				value = var:prod_input_actual_fiber
			}
		}
		if = {
			limit = {
				has_variable = prod_input_fuel
			}
			if = {
				limit = {
					var:prod_input_fuel = {
						compare_value != prev.var:prod_input_actual_fuel
					}
				}
				change_variable = {
					name = prod_update_instances_t
					multiply = var:prod_input_actual_fuel
				}
				change_variable = {
					name = prod_update_instances_t
					divide = var:prod_input_fuel
				}
			}
			change_variable = {
				name = prod_update_instances_tt
				add = 1
			}
			set_variable = {
				name = prod_input_old_fuel
				value = var:prod_input_fuel
			}
			set_variable = {
				name = prod_input_actual_old_fuel
				value = var:prod_input_actual_fuel
			}
		}
		if = {
			limit = {
				has_variable = prod_input_pottery
			}
			if = {
				limit = {
					var:prod_input_pottery = {
						compare_value != prev.var:prod_input_actual_pottery
					}
				}
				change_variable = {
					name = prod_update_instances_t
					multiply = var:prod_input_actual_pottery
				}
				change_variable = {
					name = prod_update_instances_t
					divide = var:prod_input_pottery
				}
			}
			change_variable = {
				name = prod_update_instances_tt
				add = 1
			}
			set_variable = {
				name = prod_input_old_pottery
				value = var:prod_input_pottery
			}
			set_variable = {
				name = prod_input_actual_old_pottery
				value = var:prod_input_actual_pottery
			}
		}
		if = {
			limit = {
				has_variable = prod_input_textile
			}
			if = {
				limit = {
					var:prod_input_textile = {
						compare_value != prev.var:prod_input_actual_textile
					}
				}
				change_variable = {
					name = prod_update_instances_t
					multiply = var:prod_input_actual_textile
				}
				change_variable = {
					name = prod_update_instances_t
					divide = var:prod_input_textile
				}
			}
			change_variable = {
				name = prod_update_instances_tt
				add = 1
			}
			set_variable = {
				name = prod_input_old_textile
				value = var:prod_input_textile
			}
			set_variable = {
				name = prod_input_actual_old_textile
				value = var:prod_input_actual_textile
			}
		}
		if = {
			limit = {
				var:prod_update_instances_tt > 0
			}
			set_variable = {
				name = math_root_exp
				value = 1
			}
			change_variable = {
				name = math_root_exp
				divide = var:prod_update_instances_tt
			}
			set_variable = {
				name = math_pow_base
				value = var:prod_update_instances_t
			}
			set_variable = {
				name = math_pow_exp
				value = var:math_root_exp
			}
			if = {
				limit = {
					var:math_pow_base != 0
				}
				set_variable = {
					name = prod_update_instances_t
					value = 1
				}
				while = {
					limit = {
						var:math_pow_exp >= 1
					}
					change_variable = {
						name = math_pow_exp
						subtract = 1
					}
					change_variable = {
						name = prod_update_instances_t
						multiply = var:math_pow_base
					}
				}
				while = {
					limit = {
						var:math_pow_exp < 0
					}
					change_variable = {
						name = math_pow_exp
						add = 1
					}
					change_variable = {
						name = prod_update_instances_t
						divide = var:math_pow_base
					}
				}
				if = {
					limit = {
						var:math_pow_exp != 0
					}
					set_variable = {
						name = math_ln_inp
						value = var:math_pow_base
					}
					set_variable = {
						name = math_pow_ln
						value = 0
					}
					set_variable = {
						name = math_ln_k
						value = 0
					}
					set_variable = {
						name = math_ln_div
						value = 10000
					}
					while = {
						limit = {
							var:math_ln_inp >= 2
						}
						change_variable = {
							name = math_ln_inp
							divide = 2
						}
						change_variable = {
							name = math_pow_ln
							add = 6931.472
						}
					}
					while = {
						limit = {
							var:math_ln_inp < 1
						}
						change_variable = {
							name = math_ln_inp
							multiply = 2
						}
						change_variable = {
							name = math_pow_ln
							subtract = 6931.472
						}
					}
					change_variable = {
						name = math_ln_inp
						multiply = 10000
					}
					while = {
						limit = {
							var:math_ln_k < 10
						}
						change_variable = {
							name = math_ln_k
							add = 1
						}
						change_variable = {
							name = math_ln_div
							divide = 2
						}
						set_variable = {
							name = math_ln_t
							value = 10000
						}
						change_variable = {
							name = math_ln_t
							add = var:math_ln_div
						}
						if = {
							limit = {
								var:math_ln_inp = {
									compare_value >= prev.var:math_ln_t
								}
							}
							change_variable = {
								name = math_ln_inp
								divide = var:math_ln_t
							}
							change_variable = {
								name = math_ln_inp
								multiply = 10000
							}
							set_variable = {
								name = math_lt_ind
								value = var:math_ln_k
							}
							if = {
								limit = {
									var:math_lt_ind >= 6
								}
								if = {
									limit = {
										var:math_lt_ind >= 8
									}
									if = {
										limit = {
											var:math_lt_ind >= 9
										}
										if = {
											limit = {
												var:math_lt_ind >= 10
											}
											set_variable = {
												name = math_ln_lt
												value = 9.761
											}
										}
										else = {
											set_variable = {
												name = math_ln_lt
												value = 19.512
											}
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 38.986
										}
									}
								}
								else = {
									if = {
										limit = {
											var:math_lt_ind >= 7
										}
										set_variable = {
											name = math_ln_lt
											value = 77.821
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 155.042
										}
									}
								}
							}
							else = {
								if = {
									limit = {
										var:math_lt_ind >= 3
									}
									if = {
										limit = {
											var:math_lt_ind >= 4
										}
										if = {
											limit = {
												var:math_lt_ind >= 5
											}
											set_variable = {
												name = math_ln_lt
												value = 307.717
											}
										}
										else = {
											set_variable = {
												name = math_ln_lt
												value = 606.246
											}
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 1177.83
										}
									}
								}
								else = {
									if = {
										limit = {
											var:math_lt_ind >= 2
										}
										set_variable = {
											name = math_ln_lt
											value = 2231.436
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 4054.651
										}
									}
								}
							}
							remove_variable = math_lt_ind
							change_variable = {
								name = math_pow_ln
								add = var:math_ln_lt
							}
						}
					}
					change_variable = {
						name = math_pow_ln
						divide = 10000
					}
					remove_variable = math_ln_k
					remove_variable = math_ln_div
					remove_variable = math_ln_t
					remove_variable = math_ln_lt
					remove_variable = math_ln_inp
					change_variable = {
						name = math_pow_exp
						multiply = var:math_pow_ln
					}
					set_variable = {
						name = math_e_exp
						value = var:math_pow_exp
					}
					set_variable = {
						name = math_pow_e
						value = 1
					}
					while = {
						limit = {
							var:math_e_exp >= 1
						}
						change_variable = {
							name = math_e_exp
							subtract = 1
						}
						change_variable = {
							name = math_pow_e
							multiply = 2.718
						}
					}
					while = {
						limit = {
							var:math_e_exp < 0
						}
						change_variable = {
							name = math_e_exp
							add = 1
						}
						change_variable = {
							name = math_pow_e
							divide = 2.718
						}
					}
					set_variable = {
						name = math_e_sm
						value = 1
					}
					if = {
						limit = {
							var:math_e_exp != 0
						}
						set_variable = {
							name = math_e_sq
							value = var:math_e_exp
						}
						change_variable = {
							name = math_e_sq
							multiply = var:math_e_exp
						}
						set_variable = {
							name = math_e_fct
							value = 2
						}
						set_variable = {
							name = math_e_fctl
							value = 2
						}
						set_variable = {
							name = math_e_a1
							value = var:math_e_sq
						}
						set_variable = {
							name = math_e_a2
							value = var:math_e_exp
						}
						set_variable = {
							name = math_e_a3
							value = 2
						}
						set_variable = {
							name = math_e_tmp
							value = var:math_e_a2
						}
						change_variable = {
							name = math_e_tmp
							multiply = var:math_e_a3
						}
						change_variable = {
							name = math_e_tmp
							add = var:math_e_a1
						}
						change_variable = {
							name = math_e_tmp
							divide = var:math_e_fct
						}
						change_variable = {
							name = math_e_sm
							add = var:math_e_tmp
						}
						set_variable = {
							name = math_e_prec
							value = 3
						}
						change_variable = {
							name = math_e_prec
							subtract = 1
						}
						while = {
							limit = {
								var:math_e_prec >= 1
							}
							change_variable = {
								name = math_e_prec
								subtract = 1
							}
							change_variable = {
								name = math_e_fctl
								add = 1
							}
							change_variable = {
								name = math_e_fct
								multiply = var:math_e_fctl
							}
							change_variable = {
								name = math_e_fctl
								add = 1
							}
							change_variable = {
								name = math_e_fct
								multiply = var:math_e_fctl
							}
							change_variable = {
								name = math_e_a1
								multiply = var:math_e_sq
							}
							change_variable = {
								name = math_e_a2
								multiply = var:math_e_sq
							}
							change_variable = {
								name = math_e_a3
								add = 2
							}
							set_variable = {
								name = math_e_tmp
								value = var:math_e_a2
							}
							change_variable = {
								name = math_e_tmp
								multiply = var:math_e_a3
							}
							change_variable = {
								name = math_e_tmp
								add = var:math_e_a1
							}
							change_variable = {
								name = math_e_tmp
								divide = var:math_e_fct
							}
							change_variable = {
								name = math_e_sm
								add = var:math_e_tmp
							}
						}
					}
					change_variable = {
						name = math_pow_e
						multiply = var:math_e_sm
					}
					remove_variable = math_e_sm
					remove_variable = math_e_tmp
					remove_variable = math_e_a1
					remove_variable = math_e_a2
					remove_variable = math_e_a3
					remove_variable = math_e_fctl
					remove_variable = math_e_fct
					remove_variable = math_e_prec
					remove_variable = math_e_sq
					remove_variable = math_e_exp
					change_variable = {
						name = prod_update_instances_t
						multiply = var:math_pow_e
					}
					remove_variable = math_pow_ln
					remove_variable = math_pow_e
				}
			}
			else = {
				set_variable = {
					name = prod_update_instances_t
					value = 0
				}
			}
			remove_variable = math_pow_base
			remove_variable = math_pow_exp
			remove_variable = math_root_exp
		}
		if = {
			limit = {
				has_variable = prod_output_food
			}
			set_variable = {
				name = prod_output_old_food
				value = var:prod_output_food
			}
			set_variable = {
				name = prod_output_actual_old_food
				value = var:prod_output_food
			}
			change_variable = {
				name = prod_output_actual_old_food
				multiply = var:prod_update_instances_t
			}
		}
		if = {
			limit = {
				has_variable = prod_output_fiber
			}
			set_variable = {
				name = prod_output_old_fiber
				value = var:prod_output_fiber
			}
			set_variable = {
				name = prod_output_actual_old_fiber
				value = var:prod_output_fiber
			}
			change_variable = {
				name = prod_output_actual_old_fiber
				multiply = var:prod_update_instances_t
			}
		}
		if = {
			limit = {
				has_variable = prod_output_fuel
			}
			set_variable = {
				name = prod_output_old_fuel
				value = var:prod_output_fuel
			}
			set_variable = {
				name = prod_output_actual_old_fuel
				value = var:prod_output_fuel
			}
			change_variable = {
				name = prod_output_actual_old_fuel
				multiply = var:prod_update_instances_t
			}
		}
		if = {
			limit = {
				has_variable = prod_output_pottery
			}
			set_variable = {
				name = prod_output_old_pottery
				value = var:prod_output_pottery
			}
			set_variable = {
				name = prod_output_actual_old_pottery
				value = var:prod_output_pottery
			}
			change_variable = {
				name = prod_output_actual_old_pottery
				multiply = var:prod_update_instances_t
			}
		}
		if = {
			limit = {
				has_variable = prod_output_textile
			}
			set_variable = {
				name = prod_output_old_textile
				value = var:prod_output_textile
			}
			set_variable = {
				name = prod_output_actual_old_textile
				value = var:prod_output_textile
			}
			change_variable = {
				name = prod_output_actual_old_textile
				multiply = var:prod_update_instances_t
			}
		}
		remove_variable = prod_update_instances_t
		remove_variable = prod_update_instances_tt
	}
	set_global_variable = {
		name = prod_update_instances_labor
		value = 0
	}
	set_global_variable = {
		name = prod_update_instances_farm
		value = 0
	}
	set_global_variable = {
		name = prod_update_instances_pasture
		value = 0
	}
	set_global_variable = {
		name = prod_update_instances_forest
		value = 0
	}
	set_global_variable = {
		name = prod_update_instances_workshop
		value = 0
	}
	every_in_list = {
		variable = prod_instances
		set_variable = {
			name = prod_labor
			value = var:prod_template.var:prod_labor
		}
		set_variable = {
			name = prod_land
			value = var:prod_template.var:prod_land
		}
		change_variable = {
			name = prod_labor
			multiply = var:prod_size
		}
		change_variable = {
			name = prod_land
			multiply = var:prod_size
		}
		change_global_variable = {
			name = prod_update_instances_labor
			add = var:prod_labor
		}
		var:prod_template = {
			if = {
				limit = {
					has_character_flag = prod_land_farm
				}
				change_global_variable = {
					name = prod_update_instances_farm
					add = var:prod_land
				}
			}
			else_if = {
				limit = {
					has_character_flag = prod_land_pasture
				}
				change_global_variable = {
					name = prod_update_instances_pasture
					add = var:prod_land
				}
			}
			else_if = {
				limit = {
					has_character_flag = prod_land_forest
				}
				change_global_variable = {
					name = prod_update_instances_forest
					add = var:prod_land
				}
			}
			else_if = {
				limit = {
					has_character_flag = prod_land_workshop
				}
				change_global_variable = {
					name = prod_update_instances_workshop
					add = var:prod_land
				}
			}
		}
	}
	if = {
		limit = {
			var:pop_total = {
				compare_value >= global_var:prod_update_instances_labor
			}
		}
		every_in_list = {
			variable = prod_instances
			set_variable = {
				name = prod_labor_actual
				value = var:prod_labor
			}
		}
	}
	else_if = {
		limit = {
			var:pop_total == 0
		}
		every_in_list = {
			variable = prod_instances
			set_variable = {
				name = prod_labor_actual
				value = 0
			}
		}
	}
	else = {
		set_variable = {
			name = prod_update_instances_fill
			value = var:pop_total
		}
		change_variable = {
			name = prod_update_instances_fill
			divide = global_var:prod_update_instances_labor
		}
		set_global_variable = {
			name = prod_update_instances_diff
			value = var:pop_total
		}
		every_in_list = {
			variable = prod_instances
			set_variable = {
				name = prod_labor_actual
				value = var:prod_labor
			}
			change_variable = {
				name = prod_labor_actual
				multiply = prev.var:prod_update_instances_fill
			}
			set_variable = {
				name = prod_update_instances_diff
				value = var:prod_labor_actual
			}
			change_variable = {
				name = prod_labor_actual
				divide = 1000
			}
			change_variable = {
				name = prod_labor_actual
				multiply = 1000
			}
			change_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_labor_actual
			}
			change_global_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_labor_actual
			}
		}
		while = {
			limit = {
				global_var:prod_update_instances_diff > 0
			}
			count = 100000
			ordered_in_list = {
				variable = prod_instances
				order_by = prod_update_instances_order_value
				position = 0
				set_variable = {
					name = prod_update_instances_diff
					value = 0
				}
				change_variable = {
					name = prod_labor_actual
					add = 1
				}
				change_global_variable = {
					name = prod_update_instances_diff
					subtract = 1
				}
			}
		}
		remove_variable = prod_update_instances_fill
		remove_global_variable = prod_update_instances_diff
		every_in_list = {
			variable = prod_instances
			remove_variable = prod_update_instances_diff
		}
	}
	if = {
		limit = {
			var:farm_total = {
				compare_value >= global_var:prod_update_instances_farm
			}
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_farm
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
		}
	}
	else_if = {
		limit = {
			var:farm_total == 0
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_farm
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = 0
			}
		}
	}
	else = {
		set_variable = {
			name = prod_update_instances_fill
			value = var:farm_total
		}
		change_variable = {
			name = prod_update_instances_fill
			divide = global_var:prod_update_instances_farm
		}
		set_global_variable = {
			name = prod_update_instances_diff
			value = var:farm_total
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_farm
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
			change_variable = {
				name = prod_land_actual
				multiply = prev.var:prod_update_instances_fill
			}
			set_variable = {
				name = prod_update_instances_diff
				value = var:prod_land_actual
			}
			change_variable = {
				name = prod_land_actual
				divide = 1000
			}
			change_variable = {
				name = prod_land_actual
				multiply = 1000
			}
			change_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
			change_global_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
		}
		while = {
			limit = {
				global_var:prod_update_instances_diff > 0
			}
			count = 100000
			ordered_in_list = {
				variable = prod_instances
				order_by = prod_update_instances_order_value
				position = 0
				set_variable = {
					name = prod_update_instances_diff
					value = 0
				}
				change_variable = {
					name = prod_land_actual
					add = 1
				}
				change_global_variable = {
					name = prod_update_instances_diff
					subtract = 1
				}
			}
		}
		remove_variable = prod_update_instances_fill
		remove_global_variable = prod_update_instances_diff
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_farm
				}
			}
			variable = prod_instances
			remove_variable = prod_update_instances_diff
		}
	}
	if = {
		limit = {
			var:pasture_total = {
				compare_value >= global_var:prod_update_instances_pasture
			}
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_pasture
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
		}
	}
	else_if = {
		limit = {
			var:pasture_total == 0
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_pasture
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = 0
			}
		}
	}
	else = {
		set_variable = {
			name = prod_update_instances_fill
			value = var:pasture_total
		}
		change_variable = {
			name = prod_update_instances_fill
			divide = global_var:prod_update_instances_pasture
		}
		set_global_variable = {
			name = prod_update_instances_diff
			value = var:pasture_total
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_pasture
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
			change_variable = {
				name = prod_land_actual
				multiply = prev.var:prod_update_instances_fill
			}
			set_variable = {
				name = prod_update_instances_diff
				value = var:prod_land_actual
			}
			change_variable = {
				name = prod_land_actual
				divide = 1000
			}
			change_variable = {
				name = prod_land_actual
				multiply = 1000
			}
			change_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
			change_global_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
		}
		while = {
			limit = {
				global_var:prod_update_instances_diff > 0
			}
			count = 100000
			ordered_in_list = {
				variable = prod_instances
				order_by = prod_update_instances_order_value
				position = 0
				set_variable = {
					name = prod_update_instances_diff
					value = 0
				}
				change_variable = {
					name = prod_land_actual
					add = 1
				}
				change_global_variable = {
					name = prod_update_instances_diff
					subtract = 1
				}
			}
		}
		remove_variable = prod_update_instances_fill
		remove_global_variable = prod_update_instances_diff
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_pasture
				}
			}
			variable = prod_instances
			remove_variable = prod_update_instances_diff
		}
	}
	if = {
		limit = {
			var:forest_total = {
				compare_value >= global_var:prod_update_instances_forest
			}
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_forest
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
		}
	}
	else_if = {
		limit = {
			var:forest_total == 0
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_forest
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = 0
			}
		}
	}
	else = {
		set_variable = {
			name = prod_update_instances_fill
			value = var:forest_total
		}
		change_variable = {
			name = prod_update_instances_fill
			divide = global_var:prod_update_instances_forest
		}
		set_global_variable = {
			name = prod_update_instances_diff
			value = var:forest_total
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_forest
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
			change_variable = {
				name = prod_land_actual
				multiply = prev.var:prod_update_instances_fill
			}
			set_variable = {
				name = prod_update_instances_diff
				value = var:prod_land_actual
			}
			change_variable = {
				name = prod_land_actual
				divide = 1000
			}
			change_variable = {
				name = prod_land_actual
				multiply = 1000
			}
			change_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
			change_global_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
		}
		while = {
			limit = {
				global_var:prod_update_instances_diff > 0
			}
			count = 100000
			ordered_in_list = {
				variable = prod_instances
				order_by = prod_update_instances_order_value
				position = 0
				set_variable = {
					name = prod_update_instances_diff
					value = 0
				}
				change_variable = {
					name = prod_land_actual
					add = 1
				}
				change_global_variable = {
					name = prod_update_instances_diff
					subtract = 1
				}
			}
		}
		remove_variable = prod_update_instances_fill
		remove_global_variable = prod_update_instances_diff
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_forest
				}
			}
			variable = prod_instances
			remove_variable = prod_update_instances_diff
		}
	}
	if = {
		limit = {
			var:workshop_total = {
				compare_value >= global_var:prod_update_instances_workshop
			}
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_workshop
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
		}
	}
	else_if = {
		limit = {
			var:workshop_total == 0
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_workshop
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = 0
			}
		}
	}
	else = {
		set_variable = {
			name = prod_update_instances_fill
			value = var:workshop_total
		}
		change_variable = {
			name = prod_update_instances_fill
			divide = global_var:prod_update_instances_workshop
		}
		set_global_variable = {
			name = prod_update_instances_diff
			value = var:workshop_total
		}
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_workshop
				}
			}
			variable = prod_instances
			set_variable = {
				name = prod_land_actual
				value = var:prod_land
			}
			change_variable = {
				name = prod_land_actual
				multiply = prev.var:prod_update_instances_fill
			}
			set_variable = {
				name = prod_update_instances_diff
				value = var:prod_land_actual
			}
			change_variable = {
				name = prod_land_actual
				divide = 1000
			}
			change_variable = {
				name = prod_land_actual
				multiply = 1000
			}
			change_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
			change_global_variable = {
				name = prod_update_instances_diff
				subtract = var:prod_land_actual
			}
		}
		while = {
			limit = {
				global_var:prod_update_instances_diff > 0
			}
			count = 100000
			ordered_in_list = {
				variable = prod_instances
				order_by = prod_update_instances_order_value
				position = 0
				set_variable = {
					name = prod_update_instances_diff
					value = 0
				}
				change_variable = {
					name = prod_land_actual
					add = 1
				}
				change_global_variable = {
					name = prod_update_instances_diff
					subtract = 1
				}
			}
		}
		remove_variable = prod_update_instances_fill
		remove_global_variable = prod_update_instances_diff
		every_in_list = {
			limit = {
				var:prod_template = {
					has_character_flag = prod_land_workshop
				}
			}
			variable = prod_instances
			remove_variable = prod_update_instances_diff
		}
	}
	every_in_list = {
		variable = prod_instances
		set_variable = {
			name = prod_size_actual
			value = 1
		}
		if = {
			limit = {
				var:prod_labor = {
					compare_value != var:prod_labor_actual
				}
			}
			change_variable = {
				name = prod_size_actual
				multiply = var:prod_labor_actual
			}
			change_variable = {
				name = prod_size_actual
				divide = var:prod_labor
			}
		}
		if = {
			limit = {
				var:prod_land = {
					compare_value != var:prod_land_actual
				}
			}
			change_variable = {
				name = prod_size_actual
				multiply = var:prod_land_actual
			}
			change_variable = {
				name = prod_size_actual
				divide = var:prod_land
			}
		}
		set_variable = {
			name = math_pow_base
			value = var:prod_size_actual
		}
		set_variable = {
			name = math_pow_exp
			value = 0.5
		}
		if = {
			limit = {
				var:math_pow_base != 0
			}
			set_variable = {
				name = prod_size_actual
				value = 1
			}
			while = {
				limit = {
					var:math_pow_exp >= 1
				}
				change_variable = {
					name = math_pow_exp
					subtract = 1
				}
				change_variable = {
					name = prod_size_actual
					multiply = var:math_pow_base
				}
			}
			while = {
				limit = {
					var:math_pow_exp < 0
				}
				change_variable = {
					name = math_pow_exp
					add = 1
				}
				change_variable = {
					name = prod_size_actual
					divide = var:math_pow_base
				}
			}
			if = {
				limit = {
					var:math_pow_exp != 0
				}
				set_variable = {
					name = math_ln_inp
					value = var:math_pow_base
				}
				set_variable = {
					name = math_pow_ln
					value = 0
				}
				set_variable = {
					name = math_ln_k
					value = 0
				}
				set_variable = {
					name = math_ln_div
					value = 10000
				}
				while = {
					limit = {
						var:math_ln_inp >= 2
					}
					change_variable = {
						name = math_ln_inp
						divide = 2
					}
					change_variable = {
						name = math_pow_ln
						add = 6931.472
					}
				}
				while = {
					limit = {
						var:math_ln_inp < 1
					}
					change_variable = {
						name = math_ln_inp
						multiply = 2
					}
					change_variable = {
						name = math_pow_ln
						subtract = 6931.472
					}
				}
				change_variable = {
					name = math_ln_inp
					multiply = 10000
				}
				while = {
					limit = {
						var:math_ln_k < 10
					}
					change_variable = {
						name = math_ln_k
						add = 1
					}
					change_variable = {
						name = math_ln_div
						divide = 2
					}
					set_variable = {
						name = math_ln_t
						value = 10000
					}
					change_variable = {
						name = math_ln_t
						add = var:math_ln_div
					}
					if = {
						limit = {
							var:math_ln_inp = {
								compare_value >= prev.var:math_ln_t
							}
						}
						change_variable = {
							name = math_ln_inp
							divide = var:math_ln_t
						}
						change_variable = {
							name = math_ln_inp
							multiply = 10000
						}
						set_variable = {
							name = math_lt_ind
							value = var:math_ln_k
						}
						if = {
							limit = {
								var:math_lt_ind >= 6
							}
							if = {
								limit = {
									var:math_lt_ind >= 8
								}
								if = {
									limit = {
										var:math_lt_ind >= 9
									}
									if = {
										limit = {
											var:math_lt_ind >= 10
										}
										set_variable = {
											name = math_ln_lt
											value = 9.761
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 19.512
										}
									}
								}
								else = {
									set_variable = {
										name = math_ln_lt
										value = 38.986
									}
								}
							}
							else = {
								if = {
									limit = {
										var:math_lt_ind >= 7
									}
									set_variable = {
										name = math_ln_lt
										value = 77.821
									}
								}
								else = {
									set_variable = {
										name = math_ln_lt
										value = 155.042
									}
								}
							}
						}
						else = {
							if = {
								limit = {
									var:math_lt_ind >= 3
								}
								if = {
									limit = {
										var:math_lt_ind >= 4
									}
									if = {
										limit = {
											var:math_lt_ind >= 5
										}
										set_variable = {
											name = math_ln_lt
											value = 307.717
										}
									}
									else = {
										set_variable = {
											name = math_ln_lt
											value = 606.246
										}
									}
								}
								else = {
									set_variable = {
										name = math_ln_lt
										value = 1177.83
									}
								}
							}
							else = {
								if = {
									limit = {
										var:math_lt_ind >= 2
									}
									set_variable = {
										name = math_ln_lt
										value = 2231.436
									}
								}
								else = {
									set_variable = {
										name = math_ln_lt
										value = 4054.651
									}
								}
							}
						}
						remove_variable = math_lt_ind
						change_variable = {
							name = math_pow_ln
							add = var:math_ln_lt
						}
					}
				}
				change_variable = {
					name = math_pow_ln
					divide = 10000
				}
				remove_variable = math_ln_k
				remove_variable = math_ln_div
				remove_variable = math_ln_t
				remove_variable = math_ln_lt
				remove_variable = math_ln_inp
				change_variable = {
					name = math_pow_exp
					multiply = var:math_pow_ln
				}
				set_variable = {
					name = math_e_exp
					value = var:math_pow_exp
				}
				set_variable = {
					name = math_pow_e
					value = 1
				}
				while = {
					limit = {
						var:math_e_exp >= 1
					}
					change_variable = {
						name = math_e_exp
						subtract = 1
					}
					change_variable = {
						name = math_pow_e
						multiply = 2.718
					}
				}
				while = {
					limit = {
						var:math_e_exp < 0
					}
					change_variable = {
						name = math_e_exp
						add = 1
					}
					change_variable = {
						name = math_pow_e
						divide = 2.718
					}
				}
				set_variable = {
					name = math_e_sm
					value = 1
				}
				if = {
					limit = {
						var:math_e_exp != 0
					}
					set_variable = {
						name = math_e_sq
						value = var:math_e_exp
					}
					change_variable = {
						name = math_e_sq
						multiply = var:math_e_exp
					}
					set_variable = {
						name = math_e_fct
						value = 2
					}
					set_variable = {
						name = math_e_fctl
						value = 2
					}
					set_variable = {
						name = math_e_a1
						value = var:math_e_sq
					}
					set_variable = {
						name = math_e_a2
						value = var:math_e_exp
					}
					set_variable = {
						name = math_e_a3
						value = 2
					}
					set_variable = {
						name = math_e_tmp
						value = var:math_e_a2
					}
					change_variable = {
						name = math_e_tmp
						multiply = var:math_e_a3
					}
					change_variable = {
						name = math_e_tmp
						add = var:math_e_a1
					}
					change_variable = {
						name = math_e_tmp
						divide = var:math_e_fct
					}
					change_variable = {
						name = math_e_sm
						add = var:math_e_tmp
					}
					set_variable = {
						name = math_e_prec
						value = 3
					}
					change_variable = {
						name = math_e_prec
						subtract = 1
					}
					while = {
						limit = {
							var:math_e_prec >= 1
						}
						change_variable = {
							name = math_e_prec
							subtract = 1
						}
						change_variable = {
							name = math_e_fctl
							add = 1
						}
						change_variable = {
							name = math_e_fct
							multiply = var:math_e_fctl
						}
						change_variable = {
							name = math_e_fctl
							add = 1
						}
						change_variable = {
							name = math_e_fct
							multiply = var:math_e_fctl
						}
						change_variable = {
							name = math_e_a1
							multiply = var:math_e_sq
						}
						change_variable = {
							name = math_e_a2
							multiply = var:math_e_sq
						}
						change_variable = {
							name = math_e_a3
							add = 2
						}
						set_variable = {
							name = math_e_tmp
							value = var:math_e_a2
						}
						change_variable = {
							name = math_e_tmp
							multiply = var:math_e_a3
						}
						change_variable = {
							name = math_e_tmp
							add = var:math_e_a1
						}
						change_variable = {
							name = math_e_tmp
							divide = var:math_e_fct
						}
						change_variable = {
							name = math_e_sm
							add = var:math_e_tmp
						}
					}
				}
				change_variable = {
					name = math_pow_e
					multiply = var:math_e_sm
				}
				remove_variable = math_e_sm
				remove_variable = math_e_tmp
				remove_variable = math_e_a1
				remove_variable = math_e_a2
				remove_variable = math_e_a3
				remove_variable = math_e_fctl
				remove_variable = math_e_fct
				remove_variable = math_e_prec
				remove_variable = math_e_sq
				remove_variable = math_e_exp
				change_variable = {
					name = prod_size_actual
					multiply = var:math_pow_e
				}
				remove_variable = math_pow_ln
				remove_variable = math_pow_e
			}
		}
		else = {
			set_variable = {
				name = prod_size_actual
				value = 0
			}
		}
		remove_variable = math_pow_base
		remove_variable = math_pow_exp
		change_variable = {
			name = prod_size_actual
			multiply = var:prod_size
		}
		change_variable = {
			name = prod_size_actual
			divide = 1000
		}
		change_variable = {
			name = prod_size_actual
			multiply = 1000
		}
		if = {
			limit = {
				has_variable = prod_input_food
			}
			set_variable = {
				name = prod_input_food
				value = var:prod_template.var:prod_input_food
			}
			change_variable = {
				name = prod_input_food
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_input_food
				multiply = var:prod_location.var:modi_prod_input_food
			}
		}
		if = {
			limit = {
				has_variable = prod_input_fuel
			}
			set_variable = {
				name = prod_input_fuel
				value = var:prod_template.var:prod_input_fuel
			}
			change_variable = {
				name = prod_input_fuel
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_input_fuel
				multiply = var:prod_location.var:modi_prod_input_fuel
			}
		}
		if = {
			limit = {
				has_variable = prod_input_fiber
			}
			set_variable = {
				name = prod_input_fiber
				value = var:prod_template.var:prod_input_fiber
			}
			change_variable = {
				name = prod_input_fiber
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_input_fiber
				multiply = var:prod_location.var:modi_prod_input_fiber
			}
		}
		if = {
			limit = {
				has_variable = prod_input_pottery
			}
			set_variable = {
				name = prod_input_pottery
				value = var:prod_template.var:prod_input_pottery
			}
			change_variable = {
				name = prod_input_pottery
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_input_pottery
				multiply = var:prod_location.var:modi_prod_input_pottery
			}
		}
		if = {
			limit = {
				has_variable = prod_input_textile
			}
			set_variable = {
				name = prod_input_textile
				value = var:prod_template.var:prod_input_textile
			}
			change_variable = {
				name = prod_input_textile
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_input_textile
				multiply = var:prod_location.var:modi_prod_input_textile
			}
		}
		if = {
			limit = {
				has_variable = prod_output_food
			}
			set_variable = {
				name = prod_output_food
				value = var:prod_template.var:prod_output_food
			}
			change_variable = {
				name = prod_output_food
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_output_food
				multiply = var:prod_location.var:modi_prod_output_food
			}
		}
		if = {
			limit = {
				has_variable = prod_output_fuel
			}
			set_variable = {
				name = prod_output_fuel
				value = var:prod_template.var:prod_output_fuel
			}
			change_variable = {
				name = prod_output_fuel
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_output_fuel
				multiply = var:prod_location.var:modi_prod_output_fuel
			}
		}
		if = {
			limit = {
				has_variable = prod_output_fiber
			}
			set_variable = {
				name = prod_output_fiber
				value = var:prod_template.var:prod_output_fiber
			}
			change_variable = {
				name = prod_output_fiber
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_output_fiber
				multiply = var:prod_location.var:modi_prod_output_fiber
			}
		}
		if = {
			limit = {
				has_variable = prod_output_pottery
			}
			set_variable = {
				name = prod_output_pottery
				value = var:prod_template.var:prod_output_pottery
			}
			change_variable = {
				name = prod_output_pottery
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_output_pottery
				multiply = var:prod_location.var:modi_prod_output_pottery
			}
		}
		if = {
			limit = {
				has_variable = prod_output_textile
			}
			set_variable = {
				name = prod_output_textile
				value = var:prod_template.var:prod_output_textile
			}
			change_variable = {
				name = prod_output_textile
				multiply = var:prod_size_actual
			}
			change_variable = {
				name = prod_output_textile
				multiply = var:prod_location.var:modi_prod_output_textile
			}
		}
	}
}
