every_in_global_list = { 
	variable = trade_merchants
	clear_variable_list = trade_link
	clear_variable_list = array_trade_link
	add_to_global_variable_list = { 
		name = trade_set_link_t
		target = var:trade_location
	}
}
if = { 
	limit = { 
		or = { 
			always = no
			always = yes
		}
	}
	every_in_global_list = { 
		variable = trade_set_link_t
		set_variable = { 
			name = travel_distance_distance
			value = 0
		}
		set_variable = { 
			name = travel_distance_prev
			value = this
		}
		add_to_global_variable_list = { 
			name = travel_distance_fray
			target = this
		}
		add_to_global_variable_list = { 
			name = travel_distance_visited
			target = this
		}
	}
}
else = { 
	every_in_list = { 
		variable = trade_set_link_t
		set_variable = { 
			name = travel_distance_distance
			value = 0
		}
		set_variable = { 
			name = travel_distance_prev
			value = this
		}
		add_to_global_variable_list = { 
			name = travel_distance_fray
			target = this
		}
		add_to_global_variable_list = { 
			name = travel_distance_visited
			target = this
		}
	}
}
while = { 
	limit = { 
		has_global_variable_list = travel_distance_fray
		global_variable_list_size = { 
			name = travel_distance_fray
			value >= 1
		}
	}
	count = 100000
	ordered_in_global_list = { 
		variable = travel_distance_fray
		order_by = travel_distance_order_value
		position = 0
		set_global_variable = { 
			name = travel_distance_select
			value = this
		}
		remove_list_global_variable = { 
			name = travel_distance_fray
			target = this
		}
	}
	global_var:travel_distance_select = { 
		if = { 
			limit = { 
				has_variable_list = prov_neighb
			}
			every_in_list = { 
				limit = { 
					OR = { 
						NOT = { 
							has_variable = travel_distance_distance
						}
						var:travel_distance_distance = { 
							compare_value > global_var:travel_distance_select.var:travel_distance_distance
						}
					}
				}
				variable = prov_neighb
				set_variable = { 
					name = get_distance_neighb_x_diff
					value = global_var:travel_distance_select.var:prov_x
				}
				set_variable = { 
					name = get_distance_neighb_y_diff
					value = global_var:travel_distance_select.var:prov_y
				}
				change_variable = { 
					name = get_distance_neighb_x_diff
					subtract = this.var:prov_x
				}
				change_variable = { 
					name = get_distance_neighb_y_diff
					subtract = this.var:prov_y
				}
				set_variable = { 
					name = math_dist_x
					value = var:get_distance_neighb_x_diff
				}
				set_variable = { 
					name = math_dist_y
					value = var:get_distance_neighb_y_diff
				}
				if = { 
					limit = { 
						var:math_dist_x < 0
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_x
					}
					set_variable = { 
						name = math_dist_x
						value = 0
					}
					change_variable = { 
						name = math_dist_x
						subtract = var:math_dist_t
					}
				}
				if = { 
					limit = { 
						var:math_dist_y < 0
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_y
					}
					set_variable = { 
						name = math_dist_y
						value = 0
					}
					change_variable = { 
						name = math_dist_y
						subtract = var:math_dist_t
					}
				}
				if = { 
					limit = { 
						var:math_dist_x = { 
							compare_value < prev.var:math_dist_y
						}
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_x
					}
					set_variable = { 
						name = math_dist_x
						value = var:math_dist_y
					}
					set_variable = { 
						name = math_dist_y
						value = var:math_dist_t
					}
				}
				change_variable = { 
					name = math_dist_x
					multiply = 100.7
				}
				change_variable = { 
					name = math_dist_y
					multiply = 44.1
				}
				set_variable = { 
					name = travel_distance_distance_new
					value = var:math_dist_x
				}
				change_variable = { 
					name = travel_distance_distance_new
					add = var:math_dist_y
				}
				change_variable = { 
					name = travel_distance_distance_new
					divide = 102.4
				}
				remove_variable = math_dist_x
				remove_variable = math_dist_y
				remove_variable = math_dist_t
				set_variable = { 
					name = get_distance_neighb_cost
					value = global_var:travel_distance_select.var:prov_cost
				}
				change_variable = { 
					name = get_distance_neighb_cost
					add = this.var:prov_cost
				}
				change_variable = { 
					name = travel_distance_distance_new
					multiply = var:get_distance_neighb_cost
				}
				change_variable = { 
					name = travel_distance_distance_new
					add = global_var:travel_distance_select.var:travel_distance_distance
				}
				set_variable = { 
					name = get_distance_neighb_t
					value = global_var:travel_distance_select.var:prov_sea
				}
				set_variable = { 
					name = get_distance_neighb_tt
					value = this.var:prov_sea
				}
				if = { 
					limit = { 
						NOT = { 
							var:get_distance_neighb_t = { 
								compare_value = prev.var:get_distance_neighb_tt
							}
						}
					}
					change_variable = { 
						name = travel_distance_distance_new
						add = 175
					}
				}
				remove_variable = get_distance_neighb_x_diff
				remove_variable = get_distance_neighb_y_diff
				remove_variable = get_distance_neighb_t
				remove_variable = get_distance_neighb_tt
				remove_variable = get_distance_neighb_cost
				if = { 
					limit = { 
						var:travel_distance_distance_new = { 
							compare_value <= 5000
						}
						OR = { 
							NOT = { 
								has_variable = travel_distance_distance
							}
							var:travel_distance_distance_new = { 
								compare_value < prev.var:travel_distance_distance
							}
						}
					}
					add_to_global_variable_list = { 
						name = travel_distance_fray
						target = this
					}
					add_to_global_variable_list = { 
						name = travel_distance_visited
						target = this
					}
					set_variable = { 
						name = travel_distance_distance
						value = var:travel_distance_distance_new
					}
					set_variable = { 
						name = travel_distance_prev
						value = global_var:travel_distance_select
					}
				}
				remove_variable = travel_distance_distance_new
			}
		}
		if = { 
			limit = { 
				has_variable_list = prov_port
			}
			every_in_list = { 
				limit = { 
					OR = { 
						NOT = { 
							has_variable = travel_distance_distance
						}
						var:travel_distance_distance = { 
							compare_value > global_var:travel_distance_select.var:travel_distance_distance
						}
					}
				}
				variable = prov_port
				set_variable = { 
					name = get_distance_port_t
					value = global_var:travel_distance_select.var:prov_sea
				}
				set_variable = { 
					name = get_distance_port_tt
					value = this.var:prov_sea
				}
				if = { 
					limit = { 
						OR = { 
							var:get_distance_port_t = 2
							var:get_distance_port_tt = 2
						}
					}
					set_variable = { 
						name = get_distance_port_cost
						value = 100
					}
				}
				else = { 
					set_variable = { 
						name = get_distance_port_cost
						value = 25
					}
				}
				set_variable = { 
					name = get_distance_neighb_x_diff
					value = global_var:travel_distance_select.var:prov_x
				}
				set_variable = { 
					name = get_distance_neighb_y_diff
					value = global_var:travel_distance_select.var:prov_y
				}
				change_variable = { 
					name = get_distance_neighb_x_diff
					subtract = this.var:prov_x
				}
				change_variable = { 
					name = get_distance_neighb_y_diff
					subtract = this.var:prov_y
				}
				set_variable = { 
					name = math_dist_x
					value = var:get_distance_neighb_x_diff
				}
				set_variable = { 
					name = math_dist_y
					value = var:get_distance_neighb_y_diff
				}
				if = { 
					limit = { 
						var:math_dist_x < 0
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_x
					}
					set_variable = { 
						name = math_dist_x
						value = 0
					}
					change_variable = { 
						name = math_dist_x
						subtract = var:math_dist_t
					}
				}
				if = { 
					limit = { 
						var:math_dist_y < 0
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_y
					}
					set_variable = { 
						name = math_dist_y
						value = 0
					}
					change_variable = { 
						name = math_dist_y
						subtract = var:math_dist_t
					}
				}
				if = { 
					limit = { 
						var:math_dist_x = { 
							compare_value < prev.var:math_dist_y
						}
					}
					set_variable = { 
						name = math_dist_t
						value = var:math_dist_x
					}
					set_variable = { 
						name = math_dist_x
						value = var:math_dist_y
					}
					set_variable = { 
						name = math_dist_y
						value = var:math_dist_t
					}
				}
				change_variable = { 
					name = math_dist_x
					multiply = 100.7
				}
				change_variable = { 
					name = math_dist_y
					multiply = 44.1
				}
				set_variable = { 
					name = travel_distance_distance_new
					value = var:math_dist_x
				}
				change_variable = { 
					name = travel_distance_distance_new
					add = var:math_dist_y
				}
				change_variable = { 
					name = travel_distance_distance_new
					divide = 102.4
				}
				remove_variable = math_dist_x
				remove_variable = math_dist_y
				remove_variable = math_dist_t
				set_variable = { 
					name = get_distance_neighb_cost
					value = global_var:travel_distance_select.var:prov_cost
				}
				change_variable = { 
					name = get_distance_neighb_cost
					add = this.var:prov_cost
				}
				change_variable = { 
					name = travel_distance_distance_new
					multiply = var:get_distance_neighb_cost
				}
				change_variable = { 
					name = travel_distance_distance_new
					add = global_var:travel_distance_select.var:travel_distance_distance
				}
				set_variable = { 
					name = get_distance_neighb_t
					value = global_var:travel_distance_select.var:prov_sea
				}
				set_variable = { 
					name = get_distance_neighb_tt
					value = this.var:prov_sea
				}
				if = { 
					limit = { 
						NOT = { 
							var:get_distance_neighb_t = { 
								compare_value = prev.var:get_distance_neighb_tt
							}
						}
					}
					change_variable = { 
						name = travel_distance_distance_new
						add = 175
					}
				}
				remove_variable = get_distance_neighb_x_diff
				remove_variable = get_distance_neighb_y_diff
				remove_variable = get_distance_neighb_t
				remove_variable = get_distance_neighb_tt
				remove_variable = get_distance_neighb_cost
				change_variable = { 
					name = travel_distance_distance_new
					add = var:get_distance_port_cost
				}
				remove_variable = get_distance_port_t
				remove_variable = get_distance_port_tt
				remove_variable = get_distance_port_cost
				if = { 
					limit = { 
						var:travel_distance_distance_new = { 
							compare_value <= 5000
						}
						OR = { 
							NOT = { 
								has_variable = travel_distance_distance
							}
							var:travel_distance_distance_new = { 
								compare_value < prev.var:travel_distance_distance
							}
						}
					}
					add_to_global_variable_list = { 
						name = travel_distance_fray
						target = this
					}
					add_to_global_variable_list = { 
						name = travel_distance_visited
						target = this
					}
					set_variable = { 
						name = travel_distance_distance
						value = var:travel_distance_distance_new
					}
					set_variable = { 
						name = travel_distance_prev
						value = global_var:travel_distance_select
					}
				}
				remove_variable = travel_distance_distance_new
			}
		}
	}
}
every_in_global_list = { 
	variable = travel_distance_visited
	add_to_global_variable_list = { 
		name = trade_set_link_list
		target = this
	}
	set_variable = { 
		name = trade_set_link_dist
		value = var:travel_distance_distance
	}
	set_variable = { 
		name = trade_set_link_prev
		value = var:travel_distance_prev
	}
	remove_variable = travel_distance_distance
	remove_variable = travel_distance_prev
}
clear_global_variable_list = travel_distance_fray
clear_global_variable_list = travel_distance_visited
remove_global_variable = travel_distance_select
set_global_variable = { 
	name = trade_set_link_loop
}
while = { 
	limit = { 
		has_global_variable = trade_set_link_loop
	}
	count = 10000
	remove_global_variable = trade_set_link_loop
	every_in_global_list = { 
		limit = { 
			var:trade_set_link_prev = { 
				has_variable = trade_merchant
			}
			NOT = { 
				has_variable = trade_set_link_checked
			}
		}
		variable = trade_set_link_list
		set_variable = { 
			name = trade_set_link_checked
		}
		every_in_list = { 
			limit = { 
				has_variable = trade_set_link_prev
				var:trade_set_link_prev = prev
			}
			variable = prov_neighb
			set_global_variable = { 
				name = trade_set_link_loop
			}
			set_variable = { 
				name = trade_set_link_prev
				value = prev.var:trade_set_link_prev
			}
		}
		every_in_list = { 
			limit = { 
				has_variable = trade_set_link_prev
				var:trade_set_link_prev = prev
			}
			variable = prov_port
			set_global_variable = { 
				name = trade_set_link_loop
			}
			set_variable = { 
				name = trade_set_link_prev
				value = prev.var:trade_set_link_prev
			}
		}
	}
}
every_in_global_list = { 
	variable = trade_merchants
	every_in_global_list = { 
		limit = { 
			has_variable = trade_set_link_prev
			var:trade_set_link_prev = prev.var:trade_location
		}
		variable = trade_set_link_list
		every_in_list = { 
			limit = { 
				has_variable = trade_set_link_prev
				NOT = { 
					var:trade_set_link_prev = prev.var:trade_set_link_prev
				}
			}
			variable = prov_neighb
			set_global_variable = { 
				name = trade_set_link_t
				value = var:trade_set_link_dist
			}
			change_global_variable = { 
				name = trade_set_link_t
				add = prev.var:trade_set_link_dist
			}
			var:trade_set_link_prev.var:trade_merchant = { 
				if = { 
					limit = { 
						OR = { 
							NOT = { 
								has_variable = trade_set_link_t
							}
							var:trade_set_link_t = { 
								compare_value > global_var:trade_set_link_t
							}
						}
					}
					set_variable = { 
						name = trade_set_link_t
						value = global_var:trade_set_link_t
					}
				}
			}
		}
		every_in_list = { 
			limit = { 
				has_variable = trade_set_link_prev
				NOT = { 
					var:trade_set_link_prev = prev.var:trade_set_link_prev
				}
			}
			variable = prov_port
			set_global_variable = { 
				name = trade_set_link_t
				value = var:trade_set_link_dist
			}
			change_global_variable = { 
				name = trade_set_link_t
				add = prev.var:trade_set_link_dist
			}
			var:trade_set_link_prev.var:trade_merchant = { 
				if = { 
					limit = { 
						OR = { 
							NOT = { 
								has_variable = trade_set_link_t
							}
							var:trade_set_link_t = { 
								compare_value > global_var:trade_set_link_t
							}
						}
					}
					set_variable = { 
						name = trade_set_link_t
						value = global_var:trade_set_link_t
					}
				}
			}
		}
	}
	every_in_global_list = { 
		limit = { 
			has_variable = trade_set_link_t
		}
		variable = trade_merchants
		if = { 
			limit = { 
				NOT = { 
					this = prev
				}
			}
			prev = { 
				add_to_variable_list = { 
					name = trade_link
					target = prev.var:trade_location
				}
				set_variable = { 
					name = array_add_t
					value = prev.var:trade_set_link_t
				}
				change_variable = { 
					name = array_add_t
					multiply = 10
				}
				if = { 
					limit = { 
						NOT = { 
							has_variable_list = array_trade_link
						}
					}
					add_to_variable_list = { 
						name = array_trade_link
						target = var:array_add_t
					}
				}
				else = { 
					while = { 
						limit = { 
							is_target_in_variable_list = { 
								name = array_trade_link
								target = var:array_add_t
							}
						}
						count = 10
						change_variable = { 
							name = array_add_t
							add = 0.001
						}
					}
					add_to_variable_list = { 
						name = array_trade_link
						target = var:array_add_t
					}
				}
				remove_variable = array_add_t
			}
		}
		remove_variable = trade_set_link_t
	}
}
every_in_global_list = { 
	variable = trade_merchants
	set_variable = { 
		name = trade_set_link_t
		value = 0
	}
	every_in_list = { 
		variable = trade_link
		prev = { 
			set_global_variable = { 
				name = array_get_t
				value = var:trade_set_link_t
			}
			if = { 
				limit = { 
					OR = { 
						NOT = { 
							has_global_variable = array_get_t
						}
						global_var:array_get_t = 0
					}
				}
				ordered_in_list = { 
					variable = array_trade_link
					position = 0
					prev = { 
						set_variable = { 
							name = trade_set_link_tt
							value = prev
						}
					}
				}
			}
			else = { 
				ordered_in_list = { 
					variable = array_trade_link
					position = global_var:array_get_t.compare_value
					prev = { 
						set_variable = { 
							name = trade_set_link_tt
							value = prev
						}
					}
				}
			}
			change_variable = { 
				name = trade_set_link_tt
				divide = 10
			}
			remove_global_variable = array_get_t
			change_variable = { 
				name = trade_set_link_t
				add = 1
			}
		}
		set_variable = { 
			name = trade_set_link_tt
			value = prev.var:trade_set_link_tt
		}
		set_variable = { 
			name = trade_set_link_t
			value = var:trade_set_link_tt
		}
		change_variable = { 
			name = trade_set_link_t
			divide = -50
		}
		change_variable = { 
			name = trade_set_link_t
			add = prev.var:trade_power
		}
		change_variable = { 
			name = trade_set_link_t
			subtract = var:trade_merchant.var:trade_power
		}
	}
	save_temporary_scope_as = trade_set_link_t
	set_global_variable = { 
		name = trade_set_link_loop
	}
	while = { 
		limit = { 
			has_global_variable = trade_set_link_loop
		}
		remove_global_variable = trade_set_link_loop
		every_in_list = { 
			limit = { 
				has_variable = trade_set_link_t
				var:trade_set_link_t > 0
			}
			variable = trade_link
			set_global_variable = { 
				name = trade_set_link_loop
			}
			var:trade_merchant = { 
				set_variable = { 
					name = trade_set_link_t
					value = prev.var:trade_set_link_t
				}
				set_variable = { 
					name = trade_set_link_tt
					value = prev.var:trade_set_link_tt
				}
				set_variable = { 
					name = trade_set_link_ttt
					value = 0
				}
				every_in_list = { 
					limit = { 
						NOT = { 
							this.var:trade_merchant = scope:trade_set_link_t
						}
					}
					variable = trade_link
					prev = { 
						set_global_variable = { 
							name = array_get_t
							value = var:trade_set_link_ttt
						}
						if = { 
							limit = { 
								OR = { 
									NOT = { 
										has_global_variable = array_get_t
									}
									global_var:array_get_t = 0
								}
							}
							ordered_in_list = { 
								variable = array_trade_link
								position = 0
								prev = { 
									set_variable = { 
										name = trade_set_link_tttt
										value = prev
									}
								}
							}
						}
						else = { 
							ordered_in_list = { 
								variable = array_trade_link
								position = global_var:array_get_t.compare_value
								prev = { 
									set_variable = { 
										name = trade_set_link_tttt
										value = prev
									}
								}
							}
						}
						change_variable = { 
							name = trade_set_link_tttt
							divide = 10
						}
						remove_global_variable = array_get_t
						change_variable = { 
							name = trade_set_link_ttt
							add = 1
						}
					}
					set_variable = { 
						name = trade_set_link_tttt
						value = prev.var:trade_set_link_tt
					}
					change_variable = { 
						name = trade_set_link_tttt
						add = prev.var:trade_set_link_tttt
					}
					set_variable = { 
						name = trade_set_link_ttt
						value = prev.var:trade_set_link_tttt
					}
					change_variable = { 
						name = trade_set_link_ttt
						divide = -50
					}
					change_variable = { 
						name = trade_set_link_ttt
						add = prev.var:trade_set_link_t
					}
					change_variable = { 
						name = trade_set_link_ttt
						subtract = var:trade_merchant.var:trade_power
					}
					if = { 
						limit = { 
							NOT = { 
								has_variable = trade_set_link_tt
							}
						}
						set_variable = { 
							name = trade_set_link_t
							value = var:trade_set_link_ttt
						}
						set_variable = { 
							name = trade_set_link_tt
							value = var:trade_set_link_tttt
						}
						scope:trade_set_link_t = { 
							add_to_variable_list = { 
								name = trade_link
								target = prev
							}
							set_variable = { 
								name = array_add_t
								value = prev.var:trade_set_link_tt
							}
							change_variable = { 
								name = array_add_t
								multiply = 10
							}
							if = { 
								limit = { 
									NOT = { 
										has_variable_list = array_trade_link
									}
								}
								add_to_variable_list = { 
									name = array_trade_link
									target = var:array_add_t
								}
							}
							else = { 
								while = { 
									limit = { 
										is_target_in_variable_list = { 
											name = array_trade_link
											target = var:array_add_t
										}
									}
									count = 10
									change_variable = { 
										name = array_add_t
										add = 0.001
									}
								}
								add_to_variable_list = { 
									name = array_trade_link
									target = var:array_add_t
								}
							}
							remove_variable = array_add_t
						}
					}
					else_if = { 
						limit = { 
							var:trade_set_link_tt = { 
								compare_value > prev.var:trade_set_link_tttt
							}
						}
						set_variable = { 
							name = trade_set_link_t
							value = var:trade_set_link_ttt
						}
						set_variable = { 
							name = trade_set_link_tt
							value = var:trade_set_link_tttt
						}
						save_temporary_scope_as = trade_set_link_tt
						scope:trade_set_link_t = { 
							set_global_variable = { 
								name = trade_set_link_t
								value = 0
							}
							every_in_list = { 
								variable = trade_link
								if = { 
									limit = { 
										this = scope:trade_set_link_tt
									}
									prev = { 
										remove_list_variable = { 
											name = trade_link
											target = prev
										}
										ordered_in_list = { 
											variable = array_trade_link
											position = global_var:trade_set_link_t.compare_value
											prev = { 
												remove_list_variable = { 
													name = array_trade_link
													target = prev
												}
											}
										}
									}
								}
								else = { 
									change_global_variable = { 
										name = trade_set_link_t
										add = 1
									}
								}
							}
							add_to_variable_list = { 
								name = trade_link
								target = prev
							}
							set_variable = { 
								name = array_add_t
								value = prev.var:trade_set_link_tt
							}
							change_variable = { 
								name = array_add_t
								multiply = 10
							}
							if = { 
								limit = { 
									NOT = { 
										has_variable_list = array_trade_link
									}
								}
								add_to_variable_list = { 
									name = array_trade_link
									target = var:array_add_t
								}
							}
							else = { 
								while = { 
									limit = { 
										is_target_in_variable_list = { 
											name = array_trade_link
											target = var:array_add_t
										}
									}
									count = 10
									change_variable = { 
										name = array_add_t
										add = 0.001
									}
								}
								add_to_variable_list = { 
									name = array_trade_link
									target = var:array_add_t
								}
							}
							remove_variable = array_add_t
						}
					}
				}
			}
			set_variable = { 
				name = trade_set_link_t
				value = -1
			}
		}
	}
}
every_in_global_list = { 
	variable = trade_merchants
	remove_variable = trade_set_link_t
	remove_variable = trade_set_link_tt
	remove_variable = trade_set_link_ttt
	remove_variable = trade_set_link_tttt
}
every_in_global_list = { 
	variable = trade_set_link_list
	remove_variable = trade_set_link_checked
	remove_variable = trade_set_link_dist
	remove_variable = trade_set_link_prev
	remove_variable = trade_set_link_t
	remove_variable = trade_set_link_tt
	remove_variable = trade_set_link_ttt
	remove_variable = trade_set_link_tttt
}
clear_global_variable_list = trade_set_link_list
clear_global_variable_list = trade_set_link_t
remove_global_variable = trade_set_link_t
