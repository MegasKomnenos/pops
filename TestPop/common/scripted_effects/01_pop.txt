pop_update_demand = {
	pop_set_demand = { type = calorie }
	pop_set_demand = { type = nutrient }
	pop_set_demand = { type = comfort }
	pop_set_demand = { type = luxury }
	
	pop_set_need_$type$ = yes
	
	pop_update_demand_helper = { type = calorie good = food }
	pop_update_demand_helper = { type = calorie good = fuel }
	pop_update_demand_helper = { type = calorie good = fiber }
	pop_update_demand_helper = { type = calorie good = pottery }
	pop_update_demand_helper = { type = calorie good = textile }
	
	pop_update_demand_helper = { type = nutrient good = food }
	pop_update_demand_helper = { type = nutrient good = fuel }
	pop_update_demand_helper = { type = nutrient good = fiber }
	pop_update_demand_helper = { type = nutrient good = pottery }
	pop_update_demand_helper = { type = nutrient good = textile }
	
	pop_update_demand_helper = { type = comfort good = food }
	pop_update_demand_helper = { type = comfort good = fuel }
	pop_update_demand_helper = { type = comfort good = fiber }
	pop_update_demand_helper = { type = comfort good = pottery }
	pop_update_demand_helper = { type = comfort good = textile }
	
	pop_update_demand_helper = { type = luxury good = food }
	pop_update_demand_helper = { type = luxury good = fuel }
	pop_update_demand_helper = { type = luxury good = fiber }
	pop_update_demand_helper = { type = luxury good = pottery }
	pop_update_demand_helper = { type = luxury good = textile }
}

pop_update_demand_helper = {
	if = {
		limit = {
			has_variable = pop_$type$_$good$
			
			var:pop_$type$_$good$ > 0
		}
		change_variable = { name = pop_$type$_$good$ multiply = var:pop_$type$ }
		change_variable = { name = pop_$type$_$good$ divide = pop_$type$_$good$ }
	}
}

pop_set_demand = {
	set_variable = { name = pop_$type$_food value = pop_$type$_food }
	set_variable = { name = pop_$type$_fuel value = pop_$type$_fuel }
	set_variable = { name = pop_$type$_fiber value = pop_$type$_fiber }
	set_variable = { name = pop_$type$_pottery value = pop_$type$_pottery }
	set_variable = { name = pop_$type$_textile value = pop_$type$_textile }
	
	change_variable = { name = pop_$type$_food multiply = 10 }
	change_variable = { name = pop_$type$_fuel multiply = 10 }
	change_variable = { name = pop_$type$_fiber multiply = 10 }
	change_variable = { name = pop_$type$_pottery multiply = 10 }
	change_variable = { name = pop_$type$_textile multiply = 10 }
	
	change_variable = { name = pop_$type$_food divide = var:trade_price_food }
	change_variable = { name = pop_$type$_fuel divide = var:trade_price_fuel }
	change_variable = { name = pop_$type$_fiber divide = var:trade_price_fiber }
	change_variable = { name = pop_$type$_pottery divide = var:trade_price_pottery }
	change_variable = { name = pop_$type$_textile divide = var:trade_price_textile }
	
	change_variable = { name = pop_$type$_food multiply = var:pop_$type$_food }
	change_variable = { name = pop_$type$_fuel multiply = var:pop_$type$_fuel }
	change_variable = { name = pop_$type$_fiber multiply = var:pop_$type$_fiber }
	change_variable = { name = pop_$type$_pottery multiply = var:pop_$type$_pottery }
	change_variable = { name = pop_$type$_textile multiply = var:pop_$type$_textile }
	
	set_variable = { name = pop_set_demand_t value = 0 }
	
	change_variable = { name = pop_set_demand_t add = var:pop_$type$_food }
	change_variable = { name = pop_set_demand_t add = var:pop_$type$_fuel }
	change_variable = { name = pop_set_demand_t add = var:pop_$type$_fiber }
	change_variable = { name = pop_set_demand_t add = var:pop_$type$_pottery }
	change_variable = { name = pop_set_demand_t add = var:pop_$type$_textile }
	
	change_variable = { name = pop_$type$_food divide = var:pop_set_demand_t }
	change_variable = { name = pop_$type$_fuel divide = var:pop_set_demand_t }
	change_variable = { name = pop_$type$_fiber divide = var:pop_set_demand_t }
	change_variable = { name = pop_$type$_pottery divide = var:pop_set_demand_t }
	change_variable = { name = pop_$type$_textile divide = var:pop_set_demand_t }
	
	set_variable = { name = pop_$type$_cost value = 0 }
	
	pop_set_demand_helper = { type = $type$ good = food }
	pop_set_demand_helper = { type = $type$ good = fuel }
	pop_set_demand_helper = { type = $type$ good = fiber }
	pop_set_demand_helper = { type = $type$ good = pottery }
	pop_set_demand_helper = { type = $type$ good = textile }
	
	remove_variable = pop_set_demand_t
}

pop_set_demand_helper = {
	if = {
		limit = {
			has_variable = pop_$type$_$good$
			
			var:pop_$type$_$good$ > 0
		}
		set_variable = { name = pop_set_demand_t value = var:pop_$type$_$good$ }
		change_variable = { name = pop_set_demand_t divide = pop_$type$_$good$ }
		change_variable = { name = pop_set_demand_t add = var:trade_price_$good$ }
		change_variable = { name = pop_$type$_cost add = var:pop_set_demand_t }
	}
}

pop_set_need_by_pay = {
	if = {
		limit = {
			OR = {
				NOT = {
					has_variable = pop_pay
				}
				
				var:pop_pay = 0
			}
		}
		set_variable = { name = pop_calorie value = 0.5 }
		set_variable = { name = pop_nutrient value = 0.1 }
		set_variable = { name = pop_comfort value = 0.02 }
		set_variable = { name = pop_luxury value = 0 }
	}
	else_if = {
		limit = {
			var:pop_pay = 1
		}
		set_variable = { name = pop_calorie value = 1 }
		set_variable = { name = pop_nutrient value = 0.5 }
		set_variable = { name = pop_comfort value = 0.1 }
		set_variable = { name = pop_luxury value = 0.02 }
	}
	else_if = {
		limit = {
			var:pop_pay = 2
		}
		set_variable = { name = pop_calorie value = 1 }
		set_variable = { name = pop_nutrient value = 1 }
		set_variable = { name = pop_comfort value = 0.5 }
		set_variable = { name = pop_luxury value = 0.1 }
	}
	else_if = {
		limit = {
			var:pop_pay = 3
		}
		set_variable = { name = pop_calorie value = 1 }
		set_variable = { name = pop_nutrient value = 1 }
		set_variable = { name = pop_comfort value = 1 }
		set_variable = { name = pop_luxury value = 0.5 }
	}
	else = {
		set_variable = { name = pop_calorie value = 1 }
		set_variable = { name = pop_nutrient value = 1 }
		set_variable = { name = pop_comfort value = 1 }
		set_variable = { name = pop_luxury value = 1 }
	}
}

pop_set_need_holding = {
	pop_set_need_by_pay = yes
	
	change_variable = { name = pop_calorie multiply = var:pop_total }
	change_variable = { name = pop_nutrient multiply = var:pop_total }
	change_variable = { name = pop_comfort multiply = var:pop_total }
	change_variable = { name = pop_luxury multiply = var:pop_total }
	
	change_variable = { name = pop_calorie multiply = var:modi_pop_calorie }
	change_variable = { name = pop_nutrient multiply = var:modi_pop_nutrient }
	change_variable = { name = pop_comfort multiply = var:modi_pop_comfort }
	change_variable = { name = pop_luxury multiply = var:modi_pop_luxury }
}

pop_set_need_county = {
	set_variable = { name = pop_pay value = 0 }
	
	set_variable = { name = pop_set_need_county_calorie value = 0 }
	set_variable = { name = pop_set_need_county_nutrient value = 0 }
	set_variable = { name = pop_set_need_county_comfort value = 0 }
	set_variable = { name = pop_set_need_county_luxury value = 0 }
	set_variable = { name = pop_set_need_county_cost_prev value = 0 }
	
	pop_set_need_holding = yes
	
	set_variable = { name = pop_set_need_county_loop }
	
	while = {
		limit = {
			has_variable = pop_set_need_county_loop
		}
		set_variable = { name = pop_set_need_county_cost value = 0 }
		
		set_variable = { name = pop_set_need_county_t value = var:pop_calorie }
		change_variable = { name = pop_set_need_county_t multiply = var:pop_calorie_cost }
		change_variable = { name = pop_set_need_county_cost add = var:pop_set_need_county_t }
		
		set_variable = { name = pop_set_need_county_t value = var:pop_nutrient }
		change_variable = { name = pop_set_need_county_t multiply = var:pop_nutrient_cost }
		change_variable = { name = pop_set_need_county_cost add = var:pop_set_need_county_t }
		
		set_variable = { name = pop_set_need_county_t value = var:pop_comfort }
		change_variable = { name = pop_set_need_county_t multiply = var:pop_comfort_cost }
		change_variable = { name = pop_set_need_county_cost add = var:pop_set_need_county_t }
		
		set_variable = { name = pop_set_need_county_t value = var:pop_luxury }
		change_variable = { name = pop_set_need_county_t multiply = var:pop_luxury_cost }
		change_variable = { name = pop_set_need_county_cost add = var:pop_set_need_county_t }
		
		set_variable = { name = pop_set_need_county_wealth value = var:pop_wealth }
		change_variable = { name = pop_set_need_county_wealth divide = 2 }
		
		if = {
			limit = {
				has_variable = pop_set_need_county_wealth
				
				var:pop_set_need_county_wealth = {
					compare_value >= prev.var:pop_set_need_county_cost
				}
			}
			change_variable = { name = pop_pay add = 1 }
			
			set_variable = { name = pop_set_need_county_calorie value = var:pop_calorie }
			set_variable = { name = pop_set_need_county_nutrient value = var:pop_nutrient }
			set_variable = { name = pop_set_need_county_comfort value = var:pop_comfort }
			set_variable = { name = pop_set_need_county_luxury value = var:pop_luxury }
			set_variable = { name = pop_set_need_county_cost_prev value = var:pop_set_need_county_cost }
			
			pop_set_need_holding = yes
			
			if = {
				limit = {
					var:pop_pay = 4
				}
				remove_variable = pop_set_need_county_loop
			}
		}
		else = {
			remove_variable = pop_set_need_county_loop
			
			set_variable = { name = pop_set_need_county_t value = var:pop_set_need_county_cost }
			change_variable = { name = pop_set_need_county_t subtract = var:pop_set_need_county_cost_prev }
			change_variable = { name = pop_set_need_county_wealth subtract = var:pop_set_need_county_cost_prev }
			change_variable = { name = pop_set_need_county_wealth divide = var:pop_set_need_county_t }
			
			change_variable = { name = pop_calorie subtract = var:pop_set_need_county_calorie }
			change_variable = { name = pop_nutrient subtract = var:pop_set_need_county_nutrient }
			change_variable = { name = pop_comfort subtract = var:pop_set_need_county_comfort }
			change_variable = { name = pop_luxury subtract = var:pop_set_need_county_luxury }
			
			change_variable = { name = pop_calorie multiply = var:pop_set_need_county_wealth }
			change_variable = { name = pop_nutrient multiply = var:pop_set_need_county_wealth }
			change_variable = { name = pop_comfort multiply = var:pop_set_need_county_wealth }
			change_variable = { name = pop_luxury multiply = var:pop_set_need_county_wealth }
			
			change_variable = { name = pop_calorie add = var:pop_set_need_county_calorie }
			change_variable = { name = pop_nutrient add = var:pop_set_need_county_nutrient }
			change_variable = { name = pop_comfort add = var:pop_set_need_county_comfort }
			change_variable = { name = pop_luxury add = var:pop_set_need_county_luxury }
		}
	}
	
	remove_variable = pop_set_need_county_calorie
	remove_variable = pop_set_need_county_nutrient
	remove_variable = pop_set_need_county_comfort
	remove_variable = pop_set_need_county_luxury
	remove_variable = pop_set_need_county_cost_prev
	remove_variable = pop_set_need_county_cost
	remove_variable = pop_set_need_county_t
	remove_variable = pop_set_need_county_wealth
}