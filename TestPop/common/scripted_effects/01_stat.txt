stat_main = {
	every_province = {
		limit = {
			is_valid_prov = yes
			is_city = yes
		}
		add_province_modifier = base_prov
		
		set_variable = { name = stat_tax value = var:pop_earn_serf }
		change_variable = { name = stat_tax subtract = var:pop_pay_serf }
		
		set_variable = { name = stat_main_t value = var:stat_tax }
		change_variable = { name = stat_main_t divide = 12 }
		
		if = {
			limit = {
				has_variable = stat_main_t
				
				var:stat_main_t > 0
			}
			mod_assign_2_16 = { type = province name = stat_tax var = stat_main_t }
		}
		
		set_variable = { name = stat_levy value = 0 }
		
		if = {
			limit = {
				NOT = {
					province_owner = county.holder
				}
			}
			set_variable = { name = stat_levy value = var:mil_levy }
			change_variable = { name = stat_levy multiply = 100 }
			change_variable = { name = stat_levy multiply = var:mil_supply }
			
			sqrt_effect = {
				inp = var:stat_levy
				return = stat_levy
			}
		}
		
		set_variable = { name = stat_main_t value = var:stat_levy }
		
		mod_assign_2_20 = { type = province name = stat_levy var = stat_main_t }
		
		set_variable = { name = stat_garrison value = var:stat_levy }
		
		set_variable = { name = stat_main_t value = var:stat_garrison }
		
		mod_assign_2_20 = { type = province name = stat_garrison var = stat_main_t }
		
		remove_variable = stat_main_t
	}
	
	every_ruler = {
		limit = {
			is_character = yes
			is_landed = yes
		}
		add_character_modifier = base_lord
		
		if = {
			limit = {
				is_ai = yes
			}
			set_variable = { name = stat_main_t value = var:mil_mp }
			change_variable = { name = stat_main_t multiply = var:mil_supply }
			
			sqrt_effect = {
				inp = var:stat_main_t
				return = stat_main_t
			}
			
			set_variable = { name = stat_main_tt value = var:stat_main_t }
			set_variable = { name = stat_main_ttt value = var:stat_main_t }
			
			change_variable = { name = stat_main_t multiply = 1.5 }
			
			set_variable = { name = mil_mp_cur value = 0 }
			set_variable = { name = mil_supply_cur value = 0 }
		}
		else = {
			trigger_event = {
				id = regiments.01
			}
			
			set_variable = { name = stat_main_t value = 10000 }
			
			set_variable = { name = stat_main_tt value = var:mil_mp }
			change_variable = { name = stat_main_tt subtract = var:mil_mp_cur }
			
			if = {
				limit = {
					OR = {
						NOT = {
							has_variable = stat_main_tt
						}
						
						var:stat_main_tt < 0
					}
				}
				set_variable = { name = stat_main_tt value = 0 }
			}
			else = {
				set_variable = { name = stat_main_ttt value = var:mil_supply }
				change_variable = { name = stat_main_ttt subtract = var:mil_supply_cur }
				
				if = {
					limit = {
						OR = {
							NOT = {
								has_variable = stat_main_ttt
							}
							
							var:stat_main_ttt < 0
						}
					}
					set_variable = { name = stat_main_tt value = 0 }
					set_variable = { name = stat_main_ttt value = 0 }
				}
				else = {
					change_variable = { name = stat_main_tt multiply = var:stat_main_ttt }
				}
			}
			
			sqrt_effect = {
				inp = var:stat_main_tt
				return = stat_main_tt
			}
			
			set_variable = { name = stat_main_ttt value = var:stat_main_tt }
			
			change_variable = { name = stat_main_tt multiply = 0.5 }
			change_variable = { name = stat_main_ttt multiply = 0.5 }
		}
		
		mod_assign_0_12 = { type = character name = stat_maa var = stat_main_t }
		
		every_sub_realm_county = {
			limit = {
				is_valid_prov = yes
				
				holder = prev
			}
			every_county_province = {
				limit = {
					is_valid_prov = yes
					
					is_city = yes
					
					province_owner = prev.holder
				}
				add_to_global_variable_list = { name = stat_main_t target = this }
			}
		}
		
		set_variable = { name = stat_main_t value = 0.001 }
		
		every_in_global_list = {
			variable = stat_main_t
			
			mil_prov_point = yes
			
			prev = {
				change_variable = { name = stat_main_t add = prev.var:mil_point }
			}
		}
		every_in_global_list = {
			variable = stat_main_t
			
			set_variable = { name = stat_main_t value = var:mil_point }
			change_variable = { name = stat_main_t multiply = 100 }
			change_variable = { name = stat_main_t divide = prev.var:stat_main_t }
			
			set_variable = { name = stat_main_tt value = var:stat_main_t }
			change_variable = { name = stat_main_tt multiply = prev.var:stat_main_tt }
			change_variable = { name = stat_main_tt divide = 10 }
			
			mod_assign_2_20 = { type = province name = stat_levy var = stat_main_tt }
			
			set_variable = { name = stat_main_tt value = var:stat_main_t }
			change_variable = { name = stat_main_tt multiply = prev.var:stat_main_ttt }
			change_variable = { name = stat_main_tt divide = 10 }
			
			mod_assign_2_20 = { type = province name = stat_garrison var = stat_main_tt }
			
			remove_variable = stat_main_t
			remove_variable = stat_main_tt
		}
		
		clear_global_variable_list = stat_main_t
		
		remove_variable = stat_main_t
		remove_variable = stat_main_tt
		remove_variable = stat_main_ttt
	}
}