prod_new_template = {
	create_character = {
		save_temporary_scope_as = prod_new_template_temp
		gender = male
		trait = character_not_1
		employer = global_var:arhat
		faith = global_var:arhat.faith
		culture = global_var:arhat.culture
	}

	set_global_variable = { name = $name$ value = scope:prod_new_template_temp }
	add_to_global_variable_list = { name = prod_templates target = scope:prod_new_template_temp }
	
	global_var:$name$ = {
		add_character_flag = { flag = $labor$ }
		add_character_flag = { flag = $land$ }
		
		[[input_food] set_variable = { name = prod_input_food value = $input_food$ } ]
		[[input_fuel] set_variable = { name = prod_input_fuel value = $input_fuel$ } ]
		[[input_fiber] set_variable = { name = prod_input_fiber value = $input_fiber$ } ]
		[[input_pottery] set_variable = { name = prod_input_pottery value = $input_pottery$ } ]
		[[input_textile] set_variable = { name = prod_input_textile value = $input_textile$ } ]
		
		[[output_food] set_variable = { name = prod_output_food value = $output_food$ } ]
		[[output_fuel] set_variable = { name = prod_output_fuel value = $output_fuel$ } ]
		[[output_fiber] set_variable = { name = prod_output_fiber value = $output_fiber$ } ]
		[[output_pottery] set_variable = { name = prod_output_pottery value = $output_pottery$ } ]
		[[output_textile] set_variable = { name = prod_output_textile value = $output_textile$ } ]
	}
}

prod_new_instance = {
	create_character = {
		save_temporary_scope_as = prod_new_instance_temp
		gender = male
		trait = character_not_2
		employer = global_var:arhat
		faith = global_var:arhat.faith
		culture = global_var:arhat.culture
	}
	
	add_to_global_variable_list = { name = prod_instances target = scope:prod_new_instance_temp }
	
	$template$ = {
		add_to_variable_list = { name = prod_instances target = scope:prod_new_instance_temp }
	}
	
	scope:prod_new_instance_temp = {
		set_variable = { name = prod_template value = $template$ }
		set_variable = { name = prod_owner value = $owner$ }
		
		set_variable = { name = prod_size value = 0 }
		set_variable = { name = prod_labor value = 0 }
		set_variable = { name = prod_land value = 0 }
		
		if = { limit = { $template$ = { has_variable = prod_input_food } } set_variable = { name = prod_input_food value = 0 } set_variable = { name = prod_stock_food value = 0 } }
		if = { limit = { $template$ = { has_variable = prod_output_food } } set_variable = { name = prod_output_food value = 0 } set_variable = { name = prod_stock_food value = 0 } }
		
		if = { limit = { $template$ = { has_variable = prod_input_fuel } } set_variable = { name = prod_input_fuel value = 0 } set_variable = { name = prod_stock_fuel value = 0 } }
		if = { limit = { $template$ = { has_variable = prod_output_fuel } } set_variable = { name = prod_output_fuel value = 0 } set_variable = { name = prod_stock_fuel value = 0 } }
		
		if = { limit = { $template$ = { has_variable = prod_input_fiber } } set_variable = { name = prod_input_fiber value = 0 } set_variable = { name = prod_stock_fiber value = 0 } }
		if = { limit = { $template$ = { has_variable = prod_output_fiber } } set_variable = { name = prod_output_fiber value = 0 } set_variable = { name = prod_stock_fiber value = 0 } }
		
		if = { limit = { $template$ = { has_variable = prod_input_pottery } } set_variable = { name = prod_input_pottery value = 0 } set_variable = { name = prod_stock_pottery value = 0 } }
		if = { limit = { $template$ = { has_variable = prod_output_pottery } } set_variable = { name = prod_output_pottery value = 0 } set_variable = { name = prod_stock_pottery value = 0 } }
		
		if = { limit = { $template$ = { has_variable = prod_input_textile } } set_variable = { name = prod_input_textile value = 0 } set_variable = { name = prod_stock_textile value = 0 } }
		if = { limit = { $template$ = { has_variable = prod_output_textile } } set_variable = { name = prod_output_textile value = 0 } set_variable = { name = prod_stock_textile value = 0 } }
	}
}

prod_pop_instance = {
	remove_list_global_variable = { name = prod_instances target = this }
	
	var:prod_template = {
		remove_list_variable = { name = prod_instances target = prev }
	}
	
	death = natural
}