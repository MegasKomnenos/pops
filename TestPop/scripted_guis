toggle_county_trade = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_county_trade
			}
			remove_variable = toggled_county_trade
			
			^^goods^remove_variable = info_trade_county_price_&goods&^
		}
		else = {
			set_variable = { name = toggled_county_trade value = 1 }
			
			^^goods^set_variable = { name = info_trade_county_price_&goods& value = county.var:trade_price_&goods& }^
		}
	}
}
close_county_trade = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_county_trade
			}
			remove_variable = toggled_county_trade
		
			^^goods^remove_variable = info_trade_county_price_&goods&^
		}
	}
}

toggle_prov_trade = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_trade
			}
			remove_variable = toggled_prov_trade
			
			^^goods^
				remove_variable = info_trade_prov_sply_&goods&
				remove_variable = info_trade_prov_dmnd_&goods&
				remove_variable = info_trade_prov_dmnd_pop_&goods&
				remove_variable = info_trade_prov_dmnd_prod_&goods&
				remove_variable = info_trade_prov_dmnd_build_&goods&
				remove_variable = info_trade_prov_in_&goods&
				remove_variable = info_trade_prov_in_pop_&goods&
				remove_variable = info_trade_prov_in_prod_&goods&
				remove_variable = info_trade_prov_in_build_&goods&
			^
		}
		else = {
			set_variable = { name = toggled_prov_trade value = 1 }
			
			^^goods^
				set_variable = { name = info_trade_prov_sply_&goods& value = 0 }
				set_variable = { name = info_trade_prov_dmnd_&goods& value = 0 }
				set_variable = { name = info_trade_prov_dmnd_pop_&goods& value = 0 }
				set_variable = { name = info_trade_prov_dmnd_prod_&goods& value = 0 }
				set_variable = { name = info_trade_prov_dmnd_build_&goods& value = 0 }
				set_variable = { name = info_trade_prov_in_&goods& value = 0 }
				set_variable = { name = info_trade_prov_in_pop_&goods& value = 0 }
				set_variable = { name = info_trade_prov_in_prod_&goods& value = 0 }
				set_variable = { name = info_trade_prov_in_build_&goods& value = 0 }
				
				if = {
					limit = {
						has_variable = pop_calorie_&goods&
						
						var:pop_calorie_&goods& > 0
					}
					change_variable = { name = info_trade_prov_dmnd_pop_&goods& add = var:pop_calorie_&goods& }
				}
				if = {
					limit = {
						has_variable = pop_calorie_actual_&goods&
						
						var:pop_calorie_actual_&goods& > 0
					}
					change_variable = { name = info_trade_prov_in_pop_&goods& add = var:pop_calorie_actual_&goods& }
				}
				
				if = {
					limit = {
						has_variable = pop_nutrient_&goods&
						
						var:pop_nutrient_&goods& > 0
					}
					change_variable = { name = info_trade_prov_dmnd_pop_&goods& add = var:pop_nutrient_&goods& }
				}
				if = {
					limit = {
						has_variable = pop_nutrient_actual_&goods&
						
						var:pop_nutrient_actual_&goods& > 0
					}
					change_variable = { name = info_trade_prov_in_pop_&goods& add = var:pop_nutrient_actual_&goods& }
				}
				
				if = {
					limit = {
						has_variable = pop_comfort_&goods&
						
						var:pop_comfort_&goods& > 0
					}
					change_variable = { name = info_trade_prov_dmnd_pop_&goods& add = var:pop_comfort_&goods& }
				}
				if = {
					limit = {
						has_variable = pop_comfort_actual_&goods&
						
						var:pop_comfort_actual_&goods& > 0
					}
					change_variable = { name = info_trade_prov_in_pop_&goods& add = var:pop_comfort_actual_&goods& }
				}
				
				if = {
					limit = {
						has_variable = pop_luxury_&goods&
						
						var:pop_luxury_&goods& > 0
					}
					change_variable = { name = info_trade_prov_dmnd_pop_&goods& add = var:pop_luxury_&goods& }
				}
				if = {
					limit = {
						has_variable = pop_luxury_actual_&goods&
						
						var:pop_luxury_actual_&goods& > 0
					}
					change_variable = { name = info_trade_prov_in_pop_&goods& add = var:pop_luxury_actual_&goods& }
				}

				
				every_in_list = {
					variable = prod_instances
					
					if = {
						limit = {
							has_variable = prod_sply_old_&goods&
							
							var:prod_sply_old_&goods& > 0
						}
						prev = {
							change_variable = { name = info_trade_prov_sply_&goods& add = prev.var:prod_sply_old_&goods& }
						}
					}
					if = {
						limit = {
							has_variable = prod_dmnd_old_&goods&
							
							var:prod_dmnd_old_&goods& > 0
						}
						prev = {
							change_variable = { name = info_trade_prov_dmnd_prod_&goods& add = prev.var:prod_dmnd_old_&goods& }
						}
					}
					if = {
						limit = {
							has_variable = prod_in_old_&goods&
							
							var:prod_in_old_&goods& > 0
						}
						prev = {
							change_variable = { name = info_trade_prov_in_prod_&goods& add = prev.var:prod_in_old_&goods& }
						}
					}
				}
				every_in_list = {
					variable = build_slots
					
					if = {
						limit = {
							has_variable = build_&goods&
							
							var:build_&goods& > 0
						}
						prev = {
							change_variable = { name = info_trade_prov_dmnd_build_&goods& add = prev.var:build_&goods& }
						}
					}
					if = {
						limit = {
							has_variable = build_in_&goods&
							
							var:build_in_&goods& > 0
						}
						prev = {
							change_variable = { name = info_trade_prov_in_build_&goods& add = prev.var:build_in_&goods& }
						}
					}
				}
				
				change_variable = { name = info_trade_prov_dmnd_&goods& add = var:info_trade_prov_dmnd_pop_&goods& }
				change_variable = { name = info_trade_prov_dmnd_&goods& add = var:info_trade_prov_dmnd_prod_&goods& }
				change_variable = { name = info_trade_prov_dmnd_&goods& add = var:info_trade_prov_dmnd_build_&goods& }
				
				change_variable = { name = info_trade_prov_in_&goods& add = var:info_trade_prov_in_pop_&goods& }
				change_variable = { name = info_trade_prov_in_&goods& add = var:info_trade_prov_in_prod_&goods& }
				change_variable = { name = info_trade_prov_in_&goods& add = var:info_trade_prov_in_build_&goods& }
			^
		}
	}
}
close_prov_trade = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_trade
			}
			remove_variable = toggled_prov_trade
			
			^^goods^
				remove_variable = info_trade_prov_sply_&goods&
				remove_variable = info_trade_prov_dmnd_&goods&
				remove_variable = info_trade_prov_dmnd_pop_&goods&
				remove_variable = info_trade_prov_dmnd_prod_&goods&
				remove_variable = info_trade_prov_dmnd_build_&goods&
				remove_variable = info_trade_prov_in_&goods&
				remove_variable = info_trade_prov_in_pop_&goods&
				remove_variable = info_trade_prov_in_prod_&goods&
				remove_variable = info_trade_prov_in_build_&goods&
			^
		}
	}
}

toggle_prov_pop = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_pop
			}
			remove_variable = toggled_prov_pop
			
			remove_variable = info_pop_prov_earn_pop
			remove_variable = info_pop_prov_pay_pop
			
			^^lands^
				set_variable = { name = info_pop_prov_earn_&lands& value = 0 }
				set_variable = { name = info_pop_prov_pay_&lands& value = 0 }
			^
		}
		else = {
			set_variable = { name = toggled_prov_pop value = 1 }
			
			set_variable = { name = info_pop_prov_earn_pop value = var:pop_earn_free }
			change_variable = { name = info_pop_prov_earn_pop add = var:pop_earn_serf }
			
			set_variable = { name = info_pop_prov_pay_pop value = var:pop_pay_free }
			change_variable = { name = info_pop_prov_pay_pop add = var:pop_pay_serf }
			
			if = {
				limit = {
					NOT = {
						has_variable = extraction_potential
					}
				}
				set_variable = { name = extraction_potential value = 0 }
			}
			
			^^lands^
				set_variable = { name = info_pop_prov_earn_&lands& value = 0 }
				set_variable = { name = info_pop_prov_pay_&lands& value = 0 }
				
				every_in_list = {
					limit = {
						var:prod_template = {
							has_variable = prod_land_&lands&
						}
					}
					variable = prod_instances
					
					prev = {
						change_variable = { name = info_pop_prov_earn_&lands& add = prev.var:prod_earn }
						change_variable = { name = info_pop_prov_pay_&lands& add = prev.var:prod_pay_old }
					}
				}
			^
		}
	}
}
close_prov_pop = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_pop
			}
			remove_variable = toggled_prov_pop
			
			remove_variable = info_pop_prov_earn_pop
			remove_variable = info_pop_prov_pay_pop
			
			^^lands^
				set_variable = { name = info_pop_prov_earn_&lands& value = 0 }
				set_variable = { name = info_pop_prov_pay_&lands& value = 0 }
			^
		}
	}
}

toggle_prov_prod = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_prod
			}
			remove_variable = toggled_prov_prod
		}
		else = {
			set_variable = { name = toggled_prov_prod value = 1 }
		}
	}
}
close_prov_prod = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_prod
			}
			remove_variable = toggled_prov_prod
		}
	}
}

toggle_prov_build = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_build
			}
			remove_variable = toggled_prov_build
		}
		else = {
			set_variable = { name = toggled_prov_build value = 1 }
		}
	}
}
close_prov_build = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_build
			}
			remove_variable = toggled_prov_build
		}
	}
}

toggle_prov_merchant = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_merchant
			}
			remove_variable = toggled_prov_merchant
		}
		else_if = {
			limit = {
				has_variable = trade_merchant
			}
			set_variable = { name = toggled_prov_merchant value = 1 }
		}
	}
}
close_prov_merchant = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_merchant
			}
			remove_variable = toggled_prov_merchant
		}
	}
}

toggle_prov_merchant_dat = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_merchant_dat
			}
			remove_variable = toggled_prov_merchant_dat
			
			^^goods^
				^^range5^
					remove_variable = info_dat_merchant_out_val_&range5&_&goods&
					remove_variable = info_dat_merchant_out_scope_&range5&_&goods&
					remove_variable = info_dat_merchant_in_val_&range5&_&goods&
					remove_variable = info_dat_merchant_in_scope_&range5&_&goods&
				^
			^
		}
		else_if = {
			limit = {
				has_variable = trade_merchant
			}
			set_variable = { name = toggled_prov_merchant_dat value = 1 }
			
			^^goods^
				every_in_list = {
					variable = trade_dat_&goods&
					
					prev = {
						add_to_variable_list = { name = toggled_prov_merchant_dat_t target = prev }
					}
				}
				every_in_list = {
					variable = array_trade_dat_&goods&
					
					prev = {
						add_to_variable_list = { name = array_toggled_prov_merchant_dat_t target = prev }
					}
				}
				
				^^range5^
					array_get_max = { 
						name = toggled_prov_merchant_dat_t 
						return_val = info_dat_merchant_out_val_&range5&_&goods&
						return_ind = toggled_prov_merchant_dat_t
						dec = 100
					}
					
					ordered_in_list = {
						variable = toggled_prov_merchant_dat_t
						position = global_var:toggled_prov_merchant_dat_t.compare_value
						
						prev = {
							set_variable = { name = info_dat_merchant_out_scope_&range5&_&goods& value = prev }
							
							remove_list_variable = { name = toggled_prov_merchant_dat_t target = prev }
						}
					}
					ordered_in_list = {
						variable = array_toggled_prov_merchant_dat_t
						position = global_var:toggled_prov_merchant_dat_t.compare_value
						
						prev = {
							remove_list_variable = { name = array_toggled_prov_merchant_dat_t target = prev }
						}
					}
				^
				^^range5^
					array_get_min = { 
						name = toggled_prov_merchant_dat_t 
						return_val = info_dat_merchant_in_val_&range5&_&goods&
						return_ind = toggled_prov_merchant_dat_t
						dec = 100
					}
					
					change_variable = { name = info_dat_merchant_in_val_&range5&_&goods& multiply = -1 }
					
					ordered_in_list = {
						variable = toggled_prov_merchant_dat_t
						position = global_var:toggled_prov_merchant_dat_t.compare_value
						
						prev = {
							set_variable = { name = info_dat_merchant_in_scope_&range5&_&goods& value = prev }
							
							remove_list_variable = { name = toggled_prov_merchant_dat_t target = prev }
						}
					}
					ordered_in_list = {
						variable = array_toggled_prov_merchant_dat_t
						position = global_var:toggled_prov_merchant_dat_t.compare_value
						
						prev = {
							remove_list_variable = { name = array_toggled_prov_merchant_dat_t target = prev }
						}
					}
				^
				
				remove_global_variable = toggled_prov_merchant_dat_t
				remove_variable = toggled_prov_merchant_dat_t
			^
		}
	}
}
close_prov_merchant_dat = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_prov_merchant_dat
			}
			remove_variable = toggled_prov_merchant_dat
			
			^^goods^
				^^range5^
					remove_variable = info_dat_merchant_out_val_&range5&_&goods&
					remove_variable = info_dat_merchant_out_scope_&range5&_&goods&
					remove_variable = info_dat_merchant_in_val_&range5&_&goods&
					remove_variable = info_dat_merchant_in_scope_&range5&_&goods&
				^
			^
		}
	}
}

toggle_county_dat = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_county_dat
			}
			remove_variable = toggled_county_dat
			
			^^goods^
				^^range3^
					remove_variable = info_dat_county_out_val_&range3&_&goods&
					remove_variable = info_dat_county_out_scope_&range3&_&goods&
					remove_variable = info_dat_county_in_val_&range3&_&goods&
					remove_variable = info_dat_county_in_scope_&range3&_&goods&
				^
			^
		}
		else_if = {
			limit = {
				has_variable = trade_county
			}
			set_variable = { name = toggled_county_dat value = 1 }
			
			^^goods^
				every_in_list = {
					variable = trade_dat_&goods&
					
					prev = {
						add_to_variable_list = { name = toggled_county_dat_t target = prev }
					}
				}
				every_in_list = {
					variable = array_trade_dat_&goods&
					
					prev = {
						add_to_variable_list = { name = array_toggled_county_dat_t target = prev }
					}
				}
				
				^^range3^
					array_get_max = { 
						name = toggled_county_dat_t 
						return_val = info_dat_county_out_val_&range3&_&goods&
						return_ind = toggled_county_dat_t
						dec = 100
					}
					
					ordered_in_list = {
						variable = toggled_county_dat_t
						position = global_var:toggled_county_dat_t.compare_value
						
						prev = {
							set_variable = { name = info_dat_county_out_scope_&range3&_&goods& value = prev.var:trade_location }
							
							remove_list_variable = { name = toggled_county_dat_t target = prev }
						}
					}
					ordered_in_list = {
						variable = array_toggled_county_dat_t
						position = global_var:toggled_county_dat_t.compare_value
						
						prev = {
							remove_list_variable = { name = array_toggled_county_dat_t target = prev }
						}
					}
				^
				^^range3^
					array_get_min = { 
						name = toggled_county_dat_t 
						return_val = info_dat_county_in_val_&range3&_&goods&
						return_ind = toggled_county_dat_t
						dec = 100
					}
					
					change_variable = { name = info_dat_county_in_val_&range3&_&goods& multiply = -1 }
					
					ordered_in_list = {
						variable = toggled_county_dat_t
						position = global_var:toggled_county_dat_t.compare_value
						
						prev = {
							set_variable = { name = info_dat_county_in_scope_&range3&_&goods& value = prev.var:trade_location }
							
							remove_list_variable = { name = toggled_county_dat_t target = prev }
						}
					}
					ordered_in_list = {
						variable = array_toggled_county_dat_t
						position = global_var:toggled_county_dat_t.compare_value
						
						prev = {
							remove_list_variable = { name = array_toggled_county_dat_t target = prev }
						}
					}
				^
				
				remove_global_variable = toggled_county_dat_t
				remove_variable = toggled_county_dat_t
			^
		}
	}
}
close_county_dat = {
	scope = province
	
	is_shown = {
		always = yes
	}
	is_valid = {
		always = yes
	}
	
	effect = {
		if = {
			limit = {
				has_variable = toggled_county_dat
			}
			remove_variable = toggled_county_dat
			
			^^goods^
				^^range3^
					remove_variable = info_dat_county_out_val_&range3&_&goods&
					remove_variable = info_dat_county_out_scope_&range3&_&goods&
					remove_variable = info_dat_county_in_val_&range3&_&goods&
					remove_variable = info_dat_county_in_scope_&range3&_&goods&
				^
			^
		}
	}
}